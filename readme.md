





<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://github.githubassets.com">
  <link rel="dns-prefetch" href="https://avatars0.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars1.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars2.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">



  <link crossorigin="anonymous" media="all" integrity="sha512-pWLt6abkYhNeAHaDrPVG0yXCtIGRuCkwSUqQpsyN6smAIpIt+Iuq2IZKmoH9l3Cy/9ZnjvVrFZnvFFjGiqE3EA==" rel="stylesheet" href="https://github.githubassets.com/assets/frameworks-a3b8a10d4a9e37a78f033ef4a4f525f5.css" />
  <link crossorigin="anonymous" media="all" integrity="sha512-rKfY0i2mZNv0BG7UyrzAdcm8GXBGHIB0y/hugtNxVUpHP41KoUR1CRRiR7eTvDuRDLF+x8P9fEsP7yxQwO464Q==" rel="stylesheet" href="https://github.githubassets.com/assets/github-aa5c2f579992daf0b40c175aabf01dfb.css" />
  
  
  
  
  

  <meta name="viewport" content="width=device-width">
  
  <title>hpce-2018-cw3/readme.md at master · HPCE/hpce-2018-cw3</title>
    <meta name="description" content="Contribute to HPCE/hpce-2018-cw3 development by creating an account on GitHub.">
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">

    
    <meta property="og:image" content="https://avatars2.githubusercontent.com/u/8115646?s=400&amp;v=4" /><meta property="og:site_name" content="GitHub" /><meta property="og:type" content="object" /><meta property="og:title" content="HPCE/hpce-2018-cw3" /><meta property="og:url" content="https://github.com/HPCE/hpce-2018-cw3" /><meta property="og:description" content="Contribute to HPCE/hpce-2018-cw3 development by creating an account on GitHub." />

  <link rel="assets" href="https://github.githubassets.com/">
  <link rel="web-socket" href="wss://live.github.com/_sockets/VjI6MzYzNTQ1MTAxOjU2NDhlMDc2ZjE0YzFjOTJmZTRkNmQ2MzBjYTU0NjQxODNmNzhmYWQ0OTI2ZTExMjkyNzUxY2I2ZWE2YmZkNWU=--1aeaf520ba3a41a86f134679ad8399a74d572f5f">
  <meta name="pjax-timeout" content="1000">
  <link rel="sudo-modal" href="/sessions/sudo_modal">
  <meta name="request-id" content="E558:2CDAA:3D7A648:5D6EA52:5C5ECADF" data-pjax-transient>


  

  <meta name="selected-link" value="repo_source" data-pjax-transient>

      <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
    <meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
    <meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">

  <meta name="octolytics-host" content="collector.githubapp.com" /><meta name="octolytics-app-id" content="github" /><meta name="octolytics-event-url" content="https://collector.githubapp.com/github-external/browser_event" /><meta name="octolytics-dimension-request_id" content="E558:2CDAA:3D7A648:5D6EA52:5C5ECADF" /><meta name="octolytics-dimension-region_edge" content="ams" /><meta name="octolytics-dimension-region_render" content="iad" /><meta name="octolytics-actor-id" content="24753407" /><meta name="octolytics-actor-login" content="samuraisoldier" /><meta name="octolytics-actor-hash" content="5324e8e4154a8da8528c859067ee5839e128c733038adff0976f561a4984adde" />
<meta name="analytics-location" content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" />



    <meta name="google-analytics" content="UA-3769691-2">

  <meta class="js-ga-set" name="userId" content="7e45ca2808dc844e9441a642e4b65531">

<meta class="js-ga-set" name="dimension1" content="Logged In">



  

      <meta name="hostname" content="github.com">
    <meta name="user-login" content="samuraisoldier">

      <meta name="expected-hostname" content="github.com">
    <meta name="js-proxy-site-detection-payload" content="N2NkMjg5NWUyNjk4YTNlNTEwNzNjMmEyNWFlMGJmOGJjOGNlMDE4NTc1M2VkZWQ3ZjU4MjEwNzlhOTJiZDQxOHx7InJlbW90ZV9hZGRyZXNzIjoiODEuMTAzLjI1My4xMTEiLCJyZXF1ZXN0X2lkIjoiRTU1ODoyQ0RBQTozRDdBNjQ4OjVENkVBNTI6NUM1RUNBREYiLCJ0aW1lc3RhbXAiOjE1NDk3MTYxOTIsImhvc3QiOiJnaXRodWIuY29tIn0=">

    <meta name="enabled-features" content="UNIVERSE_BANNER,MARKETPLACE_PLAN_RESTRICTION_EDITOR,NOTIFY_ON_BLOCK,RELATED_ISSUES,MARKETPLACE_BROWSING_V2,MARKETPLACE_INSIGHTS_V2">

  <meta name="html-safe-nonce" content="b93ba90b08fc476a8ce56235549a137b215bbc21">

  <meta http-equiv="x-pjax-version" content="cf994c7ead5eb7d1c8a71341838848be">
  

      <link href="https://github.com/HPCE/hpce-2018-cw3/commits/master.atom" rel="alternate" title="Recent Commits to hpce-2018-cw3:master" type="application/atom+xml">

  <meta name="go-import" content="github.com/HPCE/hpce-2018-cw3 git https://github.com/HPCE/hpce-2018-cw3.git">

  <meta name="octolytics-dimension-user_id" content="8115646" /><meta name="octolytics-dimension-user_login" content="HPCE" /><meta name="octolytics-dimension-repository_id" content="45460902" /><meta name="octolytics-dimension-repository_nwo" content="HPCE/hpce-2018-cw3" /><meta name="octolytics-dimension-repository_public" content="true" /><meta name="octolytics-dimension-repository_is_fork" content="false" /><meta name="octolytics-dimension-repository_network_root_id" content="45460902" /><meta name="octolytics-dimension-repository_network_root_nwo" content="HPCE/hpce-2018-cw3" /><meta name="octolytics-dimension-repository_explore_github_marketplace_ci_cta_shown" content="false" />


    <link rel="canonical" href="https://github.com/HPCE/hpce-2018-cw3/blob/master/readme.md" data-pjax-transient>


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <link rel="mask-icon" href="https://github.githubassets.com/pinned-octocat.svg" color="#000000">
  <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://github.githubassets.com/favicon.ico">

<meta name="theme-color" content="#1e2327">


  <meta name="u2f-support" content="true">

  <link rel="manifest" href="/manifest.json" crossOrigin="use-credentials">

  </head>

  <body class="logged-in env-production page-blob">
    

  <div class="position-relative js-header-wrapper ">
    <a href="#start-of-content" tabindex="1" class="p-3 bg-blue text-white show-on-focus js-skip-to-content">Skip to content</a>
    <div id="js-pjax-loader-bar" class="pjax-loader-bar"><div class="progress"></div></div>

    
    
    


        
<header class="Header  f5" role="banner">
  <div class="d-flex flex-justify-between px-3 ">
    <div class="d-flex flex-justify-between ">
      <div class="">
        <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
  <svg height="32" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
</a>

      </div>

    </div>

    <div class="HeaderMenu d-flex flex-justify-between flex-auto">
      <nav class="d-flex" aria-label="Global">
            <div class="">
              <div class="header-search scoped-search site-scoped-search js-site-search position-relative js-jump-to"
  role="combobox"
  aria-owns="jump-to-results"
  aria-label="Search or jump to"
  aria-haspopup="listbox"
  aria-expanded="false"
>
  <div class="position-relative">
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-site-search-form" data-scope-type="Repository" data-scope-id="45460902" data-scoped-search-url="/HPCE/hpce-2018-cw3/search" data-unscoped-search-url="/search" action="/HPCE/hpce-2018-cw3/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
      <label class="form-control header-search-wrapper header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container">
        <input type="text"
          class="form-control header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
          data-hotkey="s,/"
          name="q"
          value=""
          placeholder="Search or jump to…"
          data-unscoped-placeholder="Search or jump to…"
          data-scoped-placeholder="Search or jump to…"
          autocapitalize="off"
          aria-autocomplete="list"
          aria-controls="jump-to-results"
          aria-label="Search or jump to…"
          data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations#csrf-token=kT2JQs7s3AgFCRfpYaSYcvYChjIq5QOKk2lFkNkMwN1cW20w+hGXdkh+Yk2EionhYkB5AVoSB2/yjvUh3qg3MQ=="
          spellcheck="false"
          autocomplete="off"
          >
          <input type="hidden" class="js-site-search-type-field" name="type" >
            <img src="https://github.githubassets.com/images/search-key-slash.svg" alt="" class="mr-2 header-search-key-slash">

            <div class="Box position-absolute overflow-hidden d-none jump-to-suggestions js-jump-to-suggestions-container">
              
<ul class="d-none js-jump-to-suggestions-template-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-suggestion" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 12 16" version="1.1" role="img"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 15 16" version="1.1" role="img"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0 0 13 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 0 0 0-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"/></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>

</ul>

<ul class="d-none js-jump-to-no-results-template-container">
  <li class="d-flex flex-justify-center flex-items-center f5 d-none js-jump-to-suggestion p-2">
    <span class="text-gray">No suggested jump to results</span>
  </li>
</ul>

<ul id="jump-to-results" role="listbox" class="p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 12 16" version="1.1" role="img"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 15 16" version="1.1" role="img"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0 0 13 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 0 0 0-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"/></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>

  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-global-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 12 16" version="1.1" role="img"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 15 16" version="1.1" role="img"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M15.7 13.3l-3.81-3.83A5.93 5.93 0 0 0 13 6c0-3.31-2.69-6-6-6S1 2.69 1 6s2.69 6 6 6c1.3 0 2.48-.41 3.47-1.11l3.83 3.81c.19.2.45.3.7.3.25 0 .52-.09.7-.3a.996.996 0 0 0 0-1.41v.01zM7 10.7c-2.59 0-4.7-2.11-4.7-4.7 0-2.59 2.11-4.7 4.7-4.7 2.59 0 4.7 2.11 4.7 4.7 0 2.59-2.11 4.7-4.7 4.7z"/></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">↵</span>
    </div>
  </a>
</li>


    <li class="d-flex flex-justify-center flex-items-center p-0 f5 js-jump-to-suggestion">
      <img src="https://github.githubassets.com/images/spinners/octocat-spinner-128.gif" alt="Octocat Spinner Icon" class="m-2" width="28">
    </li>
</ul>

            </div>
      </label>
</form>  </div>
</div>

            </div>

          <ul class="d-flex pl-2 flex-items-center text-bold list-style-none">
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-hotkey="g p" data-ga-click="Header, click, Nav menu - item:pulls context:user" aria-label="Pull requests you created" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls" href="/pulls">
                Pull requests
</a>            </li>
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-hotkey="g i" data-ga-click="Header, click, Nav menu - item:issues context:user" aria-label="Issues you created" data-selected-links="/issues /issues/assigned /issues/mentioned /issues" href="/issues">
                Issues
</a>            </li>
              <li class="position-relative">
                <a class="js-selected-navigation-item HeaderNavlink px-2" data-ga-click="Header, click, Nav menu - item:marketplace context:user" data-octo-click="marketplace_click" data-octo-dimensions="location:nav_bar" data-selected-links=" /marketplace" href="/marketplace">
                   Marketplace
</a>                  
              </li>
            <li>
              <a class="js-selected-navigation-item HeaderNavlink px-2" data-ga-click="Header, click, Nav menu - item:explore" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore" href="/explore">
                Explore
</a>            </li>
          </ul>
      </nav>

      <div class="d-flex">
        
<ul class="user-nav d-flex flex-items-center list-style-none" id="user-links">
  <li class="dropdown">
    <span class="d-inline-block  px-2">
      
    <a aria-label="You have no unread notifications" class="notification-indicator tooltipped tooltipped-s  js-socket-channel js-notification-indicator" data-hotkey="g n" data-ga-click="Header, go to notifications, icon:read" data-channel="notification-changed:24753407" href="/notifications">
        <span class="mail-status "></span>
        <svg class="octicon octicon-bell" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 12v1H0v-1l.73-.58c.77-.77.81-2.55 1.19-4.42C2.69 3.23 6 2 6 2c0-.55.45-1 1-1s1 .45 1 1c0 0 3.39 1.23 4.16 5 .38 1.88.42 3.66 1.19 4.42l.66.58H14zm-7 4c1.11 0 2-.89 2-2H5c0 1.11.89 2 2 2z"/></svg>
</a>
    </span>
  </li>

  <li class="dropdown">
    <details class="details-overlay details-reset d-flex px-2 flex-items-center">
      <summary class="HeaderNavlink"
         aria-label="Create new…"
         data-ga-click="Header, create new, icon:add">
        <svg class="octicon octicon-plus float-left mr-1 mt-1" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 9H7v5H5V9H0V7h5V2h2v5h5v2z"/></svg>
        <span class="dropdown-caret mt-1"></span>
      </summary>
      <details-menu class="dropdown-menu dropdown-menu-sw">
        
<a role="menuitem" class="dropdown-item" href="/new" data-ga-click="Header, create new repository">
  New repository
</a>

  <a role="menuitem" class="dropdown-item" href="/new/import" data-ga-click="Header, import a repository">
    Import repository
  </a>

<a role="menuitem" class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, create new gist">
  New gist
</a>

  <a role="menuitem" class="dropdown-item" href="/organizations/new" data-ga-click="Header, create new organization">
    New organization
  </a>


  <div class="dropdown-divider"></div>
  <div class="dropdown-header">
    <span title="HPCE/hpce-2018-cw3">This repository</span>
  </div>
    <a role="menuitem" class="dropdown-item" href="/HPCE/hpce-2018-cw3/issues/new" data-ga-click="Header, create new issue">
      New issue
    </a>


      </details-menu>
    </details>
  </li>

  <li class="dropdown">

    <details class="details-overlay details-reset d-flex pl-2 flex-items-center">
      <summary class="HeaderNavlink name mt-1"
        aria-label="View profile and more"
        data-ga-click="Header, show menu, icon:avatar">
        <img alt="@samuraisoldier" class="avatar float-left mr-1" src="https://avatars2.githubusercontent.com/u/24753407?s=40&amp;v=4" height="20" width="20">
        <span class="dropdown-caret"></span>
      </summary>
      <details-menu class="dropdown-menu dropdown-menu-sw">
        <div class="header-nav-current-user css-truncate"><a role="menuitem" class="no-underline user-profile-link px-3 pt-2 pb-2 mb-n2 mt-n1 d-block" href="/samuraisoldier" data-ga-click="Header, go to profile, text:Signed in as">Signed in as <strong class="css-truncate-target">samuraisoldier</strong></a></div>
        <div role="none" class="dropdown-divider"></div>

        <div class="px-3 f6 user-status-container js-user-status-context pb-1" data-url="/users/status?compact=1&amp;link_mentions=0&amp;truncate=1">
          
<div class="js-user-status-container user-status-compact" data-team-hovercards-enabled>
  <details class="js-user-status-details details-reset details-overlay details-overlay-dark">
    <summary class="btn-link no-underline js-toggle-user-status-edit toggle-user-status-edit width-full" aria-haspopup="dialog" role="menuitem">
      <div class="f6 d-inline-block v-align-middle  user-status-emoji-only-header pl-0 circle lh-condensed user-status-header " style="max-width: 29px">
        <div class="user-status-emoji-container flex-shrink-0 mr-1">
          <svg class="octicon octicon-smiley" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z"/></svg>
        </div>
      </div>
      <div class="d-inline-block v-align-middle user-status-message-wrapper f6 lh-condensed ws-normal pt-1">
          <span class="link-gray">Set your status</span>
      </div>
    </summary>
    <details-dialog class="details-dialog rounded-1 anim-fade-in fast Box Box--overlay" role="dialog" tabindex="-1">
      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="position-relative flex-auto js-user-status-form" action="/users/status?compact=1&amp;link_mentions=0&amp;truncate=1" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="put" /><input type="hidden" name="authenticity_token" value="iRZeQVcE3/UBUDpzEjP2Z1v8MRJOinfwwCUnRa+Fl4mJMOD8EC3IG4GcnkEYSbS2PXCvYGSuMmnXt1fuhcwBsw==" />
        <div class="Box-header bg-gray border-bottom p-3">
          <button class="Box-btn-octicon js-toggle-user-status-edit btn-octicon float-right" type="reset" aria-label="Close dialog" data-close-dialog>
            <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48L7.48 8z"/></svg>
          </button>
          <h3 class="Box-title f5 text-bold text-gray-dark">Edit status</h3>
        </div>
        <input type="hidden" name="emoji" class="js-user-status-emoji-field" value="">
        <input type="hidden" name="organization_id" class="js-user-status-org-id-field" value="">
        <div class="px-3 py-2 text-gray-dark">
          <div class="js-characters-remaining-container js-suggester-container position-relative mt-2">
            <div class="input-group d-table form-group my-0 js-user-status-form-group">
              <span class="input-group-button d-table-cell v-align-middle" style="width: 1%">
                <button type="button" aria-label="Choose an emoji" class="btn-outline btn js-toggle-user-status-emoji-picker bg-white btn-open-emoji-picker">
                  <span class="js-user-status-original-emoji" hidden></span>
                  <span class="js-user-status-custom-emoji"></span>
                  <span class="js-user-status-no-emoji-icon" >
                    <svg class="octicon octicon-smiley" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z"/></svg>
                  </span>
                </button>
              </span>
              <input type="text" autocomplete="off" autofocus data-maxlength="80" class="js-suggester-field d-table-cell width-full form-control js-user-status-message-field js-characters-remaining-field" placeholder="What's happening?" name="message" required value="" aria-label="What is your current status?">
              <div class="error">Could not update your status, please try again.</div>
            </div>
            <div class="suggester-container">
              <div class="suggester js-suggester js-navigation-container" data-url="/autocomplete/user-suggestions" data-no-org-url="/autocomplete/user-suggestions" data-org-url="/suggestions" hidden>
              </div>
            </div>
            <div style="margin-left: 53px" class="my-1 text-small label-characters-remaining js-characters-remaining" data-suffix="remaining" hidden>
              80 remaining
            </div>
          </div>
          <include-fragment class="js-user-status-emoji-picker" data-url="/users/status/emoji"></include-fragment>
          <div class="overflow-auto" style="max-height: 33vh">
            <div class="user-status-suggestions js-user-status-suggestions">
              <h4 class="f6 text-normal my-3">Suggestions:</h4>
              <div class="mx-3 mt-2 clearfix">
                  <div class="float-left col-6">
                      <button type="button" value=":palm_tree:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="palm_tree" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f334.png">🌴</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message" style="border-left: 1px solid transparent">
                          On vacation
                        </div>
                      </button>
                      <button type="button" value=":face_with_thermometer:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="face_with_thermometer" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f912.png">🤒</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message" style="border-left: 1px solid transparent">
                          Out sick
                        </div>
                      </button>
                  </div>
                  <div class="float-left col-6">
                      <button type="button" value=":house:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="house" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f3e0.png">🏠</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message" style="border-left: 1px solid transparent">
                          Working from home
                        </div>
                      </button>
                      <button type="button" value=":dart:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="dart" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f3af.png">🎯</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message" style="border-left: 1px solid transparent">
                          Focusing
                        </div>
                      </button>
                  </div>
              </div>
            </div>
            <div class="user-status-limited-availability-container">
              <div class="form-checkbox my-0">
                <input type="checkbox" name="limited_availability" value="1" class="js-user-status-limited-availability-checkbox" data-default-message="I may be slow to respond." aria-describedby="limited-availability-help-text-truncate-true" id="limited-availability-truncate-true">
                <label class="d-block f5 text-gray-dark mb-1" for="limited-availability-truncate-true">
                  Busy
                </label>
                <p class="note" id="limited-availability-help-text-truncate-true">
                  When others mention you, assign you, or request your review,
                  GitHub will let them know that you have limited availability.
                </p>
              </div>
            </div>
          </div>
          <include-fragment class="js-user-status-org-picker" data-url="/users/status/organizations"></include-fragment>
        </div>
        <div class="d-flex flex-items-center flex-justify-between p-3 border-top">
          <button type="submit" disabled class="width-full btn btn-primary mr-2 js-user-status-submit">
            Set status
          </button>
          <button type="button" disabled class="width-full js-clear-user-status-button btn ml-2 ">
            Clear status
          </button>
        </div>
</form>    </details-dialog>
  </details>
</div>

        </div>
        <div role="none" class="dropdown-divider"></div>

        <a role="menuitem" class="dropdown-item" href="/samuraisoldier" data-ga-click="Header, go to profile, text:your profile">Your profile</a>
        <a role="menuitem" class="dropdown-item" href="/samuraisoldier?tab=repositories" data-ga-click="Header, go to repositories, text:your repositories">Your repositories</a>

        <a role="menuitem" class="dropdown-item" href="/samuraisoldier?tab=projects" data-ga-click="Header, go to projects, text:your projects">Your projects</a>

        <a role="menuitem" class="dropdown-item" href="/samuraisoldier?tab=stars" data-ga-click="Header, go to starred repos, text:your stars">Your stars</a>
          <a role="menuitem" class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, your gists, text:your gists">Your gists</a>

        <div role="none" class="dropdown-divider"></div>
        <a role="menuitem" class="dropdown-item" href="https://help.github.com" data-ga-click="Header, go to help, text:help">Help</a>
        <a role="menuitem" class="dropdown-item" href="/settings/profile" data-ga-click="Header, go to settings, icon:settings">Settings</a>
        <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="logout-form" action="/logout" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="gMXzs8XUZ5GlGPYS0CBh3+EiM+kOl8HGpTwB4KAjlfP5Ksl61ku1QO4wOLMXCTBXLTcAe0C3BcJawhCdKkU2Gw==" />
          
          <button type="submit" class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout" role="menuitem">
            Sign out
          </button>
</form>      </details-menu>
    </details>
  </li>
</ul>



        <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="sr-only right-0" action="/logout" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="XlytZlx8ysFApN6sKeXl3Wclf9kB25DmoZM2JeDNdrgns5evT+MYEAuMEA3uzLRVqzBMS0/7VOJebSdYaqvVUA==" />
          <button type="submit" class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout">
            Sign out
          </button>
</form>      </div>
    </div>
  </div>
</header>

      

  </div>

  <div id="start-of-content" class="show-on-focus"></div>

    <div id="js-flash-container">

</div>



  <div role="main" class="application-main " data-commit-hovercards-enabled>
        <div itemscope itemtype="http://schema.org/SoftwareSourceCode" class="">
    <div id="js-repo-pjax-container" data-pjax-container >
      


  


  




  <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav  ">
    <div class="repohead-details-container clearfix container">

      <ul class="pagehead-actions">

  <li>
        <!-- '"` --><!-- </textarea></xmp> --></option></form><form data-remote="true" class="js-social-form js-social-container" action="/notifications/subscribe" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="Hybd6POrVtMQzXrzCSVB12h2y+ooQsyblEuMfdKtHXBqzeQgoKr+7aWE6+mdBRpRCePJnqBKhveYkrpL2Elodw==" />      <input type="hidden" name="repository_id" id="repository_id" value="45460902" class="form-control" />

      <details class="details-reset details-overlay select-menu float-left">
        <summary class="btn btn-sm btn-with-count select-menu-button" data-ga-click="Repository, click Watch settings, action:blob#show">
          <span data-menu-button>
              <svg class="octicon octicon-eye v-align-text-bottom" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"/></svg>
              Watch
          </span>
        </summary>
        <details-menu class="select-menu-modal position-absolute mt-5" style="z-index: 99;">
          <div class="select-menu-header">
            <span class="select-menu-title">Notifications</span>
          </div>
          <div class="select-menu-list">
            <button type="submit" name="do" value="included" class="select-menu-item width-full" aria-checked="true" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5L12 5z"/></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Not watching</span>
                <span class="description">Be notified only when participating or @mentioned.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg class="octicon octicon-eye v-align-text-bottom" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"/></svg>
                  Watch
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="release_only" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5L12 5z"/></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Releases only</span>
                <span class="description">Be notified of new releases, and when participating or @mentioned.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg class="octicon octicon-eye v-align-text-bottom" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"/></svg>
                  Unwatch releases
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="subscribed" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5L12 5z"/></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Watching</span>
                <span class="description">Be notified of all conversations.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg class="octicon octicon-eye v-align-text-bottom" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"/></svg>
                  Unwatch
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="ignore" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5L12 5z"/></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Ignoring</span>
                <span class="description">Never be notified.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg class="octicon octicon-mute v-align-text-bottom" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 2.81v10.38c0 .67-.81 1-1.28.53L3 10H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h2l3.72-3.72C7.19 1.81 8 2.14 8 2.81zm7.53 3.22l-1.06-1.06-1.97 1.97-1.97-1.97-1.06 1.06L11.44 8 9.47 9.97l1.06 1.06 1.97-1.97 1.97 1.97 1.06-1.06L13.56 8l1.97-1.97z"/></svg>
                  Stop ignoring
                </span>
              </div>
            </button>
          </div>
        </details-menu>
      </details>
      <a class="social-count js-social-count"
        href="/HPCE/hpce-2018-cw3/watchers"
        aria-label="4 users are watching this repository">
        4
      </a>
</form>
  </li>

  <li>
      <div class="js-toggler-container js-social-container starring-container ">
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="starred js-social-form" action="/HPCE/hpce-2018-cw3/unstar" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="/WM2gUzi1XxPJa9Qe3tf8MLs/SRIJM+Lqk3F20im1i/DACAdx1n/aMAE71xjaemaGFXvrXRtqFzK7LUjijfNAw==" />
      <input type="hidden" name="context" value="repository"></input>
      <button
        type="submit"
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Unstar this repository" title="Unstar HPCE/hpce-2018-cw3"
        data-ga-click="Repository, click unstar button, action:blob#show; text:Unstar">
        <svg class="octicon octicon-star v-align-text-bottom" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z"/></svg>
        Unstar
      </button>
        <a class="social-count js-social-count" href="/HPCE/hpce-2018-cw3/stargazers"
           aria-label="0 users starred this repository">
          0
        </a>
</form>
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="unstarred js-social-form" action="/HPCE/hpce-2018-cw3/star" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="csIaP/zCpfmrU5c+IOID8EkVsotmQnZTBzvqr7Ce+/mfo+dP+HMNA1ht/wFDd1N2JOFMAzQyB7NarvMtIcfntQ==" />
      <input type="hidden" name="context" value="repository"></input>
      <button
        type="submit"
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Star this repository" title="Star HPCE/hpce-2018-cw3"
        data-ga-click="Repository, click star button, action:blob#show; text:Star">
        <svg class="octicon octicon-star v-align-text-bottom" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z"/></svg>
        Star
      </button>
        <a class="social-count js-social-count" href="/HPCE/hpce-2018-cw3/stargazers"
           aria-label="0 users starred this repository">
          0
        </a>
</form>  </div>

  </li>

  <li>
          <details class="details-reset details-overlay details-overlay-dark d-inline-block float-left"
            data-deferred-details-content-url="/HPCE/hpce-2018-cw3/fork?fragment=1">
            <summary class="btn btn-sm btn-with-count"
              title="Fork your own copy of HPCE/hpce-2018-cw3 to your account"
              data-ga-click="Repository, show fork modal, action:blob#show; text:Fork">
              <svg class="octicon octicon-repo-forked v-align-text-bottom" viewBox="0 0 10 16" version="1.1" width="10" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"/></svg>
              Fork
            </summary>
            <details-dialog class="anim-fade-in fast Box Box--overlay d-flex flex-column">
              <div class="Box-header">
                <button class="Box-btn-octicon btn-octicon float-right" type="button" aria-label="Close dialog" data-close-dialog>
                  <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48L7.48 8z"/></svg>
                </button>
                <h3 class="Box-title">Fork hpce-2018-cw3</h3>
              </div>
              <div class="overflow-auto text-center">
                <include-fragment>
                  <div class="octocat-spinner my-3" aria-label="Loading..."></div>
                  <p class="f5 text-gray">If this dialog fails to load, you can visit <a href="/HPCE/hpce-2018-cw3/fork">the fork page</a> directly.</p>
                </include-fragment>
              </div>
            </details-dialog>
          </details>

    <a href="/HPCE/hpce-2018-cw3/network/members" class="social-count"
       aria-label="3 users forked this repository">
      3
    </a>
  </li>
</ul>

      <h1 class="public ">
  <svg class="octicon octicon-repo" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"/></svg>
  <span class="author" itemprop="author"><a class="url fn" rel="author" data-hovercard-type="organization" data-hovercard-url="/orgs/HPCE/hovercard" href="/HPCE">HPCE</a></span><!--
--><span class="path-divider">/</span><!--
--><strong itemprop="name"><a data-pjax="#js-repo-pjax-container" href="/HPCE/hpce-2018-cw3">hpce-2018-cw3</a></strong>

</h1>

    </div>
    
<nav class="reponav js-repo-nav js-sidenav-container-pjax container"
     itemscope
     itemtype="http://schema.org/BreadcrumbList"
    aria-label="Repository"
     data-pjax="#js-repo-pjax-container">

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a class="js-selected-navigation-item selected reponav-item" itemprop="url" data-hotkey="g c" aria-current="page" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages /HPCE/hpce-2018-cw3" href="/HPCE/hpce-2018-cw3">
      <svg class="octicon octicon-code" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg>
      <span itemprop="name">Code</span>
      <meta itemprop="position" content="1">
</a>  </span>

    <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
      <a itemprop="url" data-hotkey="g i" class="js-selected-navigation-item reponav-item" data-selected-links="repo_issues repo_labels repo_milestones /HPCE/hpce-2018-cw3/issues" href="/HPCE/hpce-2018-cw3/issues">
        <svg class="octicon octicon-issue-opened" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg>
        <span itemprop="name">Issues</span>
        <span class="Counter">10</span>
        <meta itemprop="position" content="2">
</a>    </span>

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a data-hotkey="g p" itemprop="url" class="js-selected-navigation-item reponav-item" data-selected-links="repo_pulls checks /HPCE/hpce-2018-cw3/pulls" href="/HPCE/hpce-2018-cw3/pulls">
      <svg class="octicon octicon-git-pull-request" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"/></svg>
      <span itemprop="name">Pull requests</span>
      <span class="Counter">1</span>
      <meta itemprop="position" content="3">
</a>  </span>


    <a data-hotkey="g b" class="js-selected-navigation-item reponav-item" data-selected-links="repo_projects new_repo_project repo_project /HPCE/hpce-2018-cw3/projects" href="/HPCE/hpce-2018-cw3/projects">
      <svg class="octicon octicon-project" viewBox="0 0 15 16" version="1.1" width="15" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/></svg>
      Projects
      <span class="Counter" >0</span>
</a>

    <a class="js-selected-navigation-item reponav-item" data-hotkey="g w" data-selected-links="repo_wiki /HPCE/hpce-2018-cw3/wiki" href="/HPCE/hpce-2018-cw3/wiki">
      <svg class="octicon octicon-book" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3 5h4v1H3V5zm0 3h4V7H3v1zm0 2h4V9H3v1zm11-5h-4v1h4V5zm0 2h-4v1h4V7zm0 2h-4v1h4V9zm2-6v9c0 .55-.45 1-1 1H9.5l-1 1-1-1H2c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h5.5l1 1 1-1H15c.55 0 1 .45 1 1zm-8 .5L7.5 3H2v9h6V3.5zm7-.5H9.5l-.5.5V12h6V3z"/></svg>
      Wiki
</a>
    <a class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors dependency_graph pulse alerts security people /HPCE/hpce-2018-cw3/pulse" href="/HPCE/hpce-2018-cw3/pulse">
      <svg class="octicon octicon-graph" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M16 14v1H0V0h1v14h15zM5 13H3V8h2v5zm4 0H7V3h2v10zm4 0h-2V6h2v7z"/></svg>
      Insights
</a>

</nav>


  </div>
<div class="container new-discussion-timeline experiment-repo-nav  ">
  <div class="repository-content ">

    
    



  
    <a class="d-none js-permalink-shortcut" data-hotkey="y" href="/HPCE/hpce-2018-cw3/blob/93c8ce1ac68252d67e9f243590a7ed58c4667f91/readme.md">Permalink</a>

    <!-- blob contrib key: blob_contributors:v21:802772201cdab9e2f95fc1addacd9796 -->

    

    <div class="file-navigation">
      
<details class="details-reset details-overlay select-menu branch-select-menu float-left">
  <summary class="btn btn-sm select-menu-button css-truncate"
           data-hotkey="w"
           
           title="Switch branches or tags">
    <i>Branch:</i>
    <span class="css-truncate-target">master</span>
  </summary>

  <details-menu class="select-menu-modal position-absolute" style="z-index: 99;" src="/HPCE/hpce-2018-cw3/ref-list/master/readme.md?source_action=show&amp;source_controller=blob" preload>
    <include-fragment class="select-menu-loading-overlay anim-pulse">
      <svg height="32" class="octicon octicon-octoface" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M14.7 5.34c.13-.32.55-1.59-.13-3.31 0 0-1.05-.33-3.44 1.3-1-.28-2.07-.32-3.13-.32s-2.13.04-3.13.32c-2.39-1.64-3.44-1.3-3.44-1.3-.68 1.72-.26 2.99-.13 3.31C.49 6.21 0 7.33 0 8.69 0 13.84 3.33 15 7.98 15S16 13.84 16 8.69c0-1.36-.49-2.48-1.3-3.35zM8 14.02c-3.3 0-5.98-.15-5.98-3.35 0-.76.38-1.48 1.02-2.07 1.07-.98 2.9-.46 4.96-.46 2.07 0 3.88-.52 4.96.46.65.59 1.02 1.3 1.02 2.07 0 3.19-2.68 3.35-5.98 3.35zM5.49 9.01c-.66 0-1.2.8-1.2 1.78s.54 1.79 1.2 1.79c.66 0 1.2-.8 1.2-1.79s-.54-1.78-1.2-1.78zm5.02 0c-.66 0-1.2.79-1.2 1.78s.54 1.79 1.2 1.79c.66 0 1.2-.8 1.2-1.79s-.53-1.78-1.2-1.78z"/></svg>
    </include-fragment>
  </details-menu>
</details>

      <div class="BtnGroup float-right">
        <a href="/HPCE/hpce-2018-cw3/find/master"
              class="js-pjax-capture-input btn btn-sm BtnGroup-item"
              data-pjax
              data-hotkey="t">
          Find file
        </a>
        <clipboard-copy for="blob-path" class="btn btn-sm BtnGroup-item">
          Copy path
        </clipboard-copy>
      </div>
      <div id="blob-path" class="breadcrumb">
        <span class="repo-root js-repo-root"><span class="js-path-segment"><a data-pjax="true" href="/HPCE/hpce-2018-cw3"><span>hpce-2018-cw3</span></a></span></span><span class="separator">/</span><strong class="final-path">readme.md</strong>
      </div>
    </div>


    <include-fragment src="/HPCE/hpce-2018-cw3/contributors/master/readme.md" class="commit-tease commit-loader">
      <div>
        Fetching contributors&hellip;
      </div>

      <div class="commit-tease-contributors">
          <img alt="" class="loader-loading float-left" src="https://github.githubassets.com/images/spinners/octocat-spinner-32-EAF2F5.gif" width="16" height="16" />
        <span class="loader-error">Cannot retrieve contributors at this time</span>
      </div>
</include-fragment>



    <div class="file ">
      
<div class="file-header">

  <div class="file-actions">


    <div class="BtnGroup">
      <a id="raw-url" class="btn btn-sm BtnGroup-item" href="/HPCE/hpce-2018-cw3/raw/master/readme.md">Raw</a>
        <a class="btn btn-sm js-update-url-with-hash BtnGroup-item" data-hotkey="b" href="/HPCE/hpce-2018-cw3/blame/master/readme.md">Blame</a>
      <a rel="nofollow" class="btn btn-sm BtnGroup-item" href="/HPCE/hpce-2018-cw3/commits/master/readme.md">History</a>
    </div>


        <a class="btn-octicon tooltipped tooltipped-nw"
           href="x-github-client://openRepo/https://github.com/HPCE/hpce-2018-cw3?branch=master&amp;filepath=readme.md"
           aria-label="Open this file in GitHub Desktop"
           data-ga-click="Repository, open with desktop, type:windows">
            <svg class="octicon octicon-device-desktop" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M15 2H1c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h5.34c-.25.61-.86 1.39-2.34 2h8c-1.48-.61-2.09-1.39-2.34-2H15c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm0 9H1V3h14v8z"/></svg>
        </a>

          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form js-update-url-with-hash" action="/HPCE/hpce-2018-cw3/edit/master/readme.md" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="VLjhpOp/uUPQzPMh1/BoxX0pwwB8YLxVkg3NiNvuPjvoS3W/vG9IG45C1KWnkPVow5koPOI1VpxapOu4ziyNHA==" />
            <button class="btn-octicon tooltipped tooltipped-nw" type="submit"
              aria-label="Fork this project and edit the file" data-hotkey="e" data-disable-with>
              <svg class="octicon octicon-pencil" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z"/></svg>
            </button>
</form>
        <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form" action="/HPCE/hpce-2018-cw3/delete/master/readme.md" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="N7VdIu/+hMyOBQvNBAZZ95t4V1hOx22TUNUxviPbNuOVXrhOiOIWwLJiUzNQrlduIzkvXNB4moM9609lJdemXQ==" />
          <button class="btn-octicon btn-octicon-danger tooltipped tooltipped-nw" type="submit"
            aria-label="Fork this project and delete the file" data-disable-with>
            <svg class="octicon octicon-trashcan" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 2H9c0-.55-.45-1-1-1H5c-.55 0-1 .45-1 1H2c-.55 0-1 .45-1 1v1c0 .55.45 1 1 1v9c0 .55.45 1 1 1h7c.55 0 1-.45 1-1V5c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 12H3V5h1v8h1V5h1v8h1V5h1v8h1V5h1v9zm1-10H2V3h9v1z"/></svg>
          </button>
</form>  </div>

  <div class="file-info">
      1861 lines (1430 sloc)
      <span class="file-info-divider"></span>
    68 KB
  </div>
</div>

      
  <div id=readme class="readme blob instapaper_body js-code-block-container">
    <article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-overal-goals" class="anchor" aria-hidden="true" href="#overal-goals"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overal Goals</h1>
<p>The deadline for this coursework is:</p>
<pre><code>22:00 Mon 11 Feb
</code></pre>
<p>Submission of deliverables is via github only, with only
a hash going into blackboard to prove when you submitted.</p>
<p>The overall goals of this coursework are to:</p>
<ul>
<li>
<p>Develop familiarity with building OpenCL programs</p>
</li>
<li>
<p>Follow a simple methodology for isolating the parts of an existing
program which can move to a kernel</p>
</li>
<li>
<p>Understand the OpenCL primitives needed to create and execute a kernel</p>
</li>
<li>
<p>Examine and remove some of the communications bottlenecks which
can reduce performance</p>
</li>
<li>
<p>Look at some simple techniques for improving GPU performance</p>
</li>
<li>
<p>Explore remote GPU instances via AWS</p>
</li>
</ul>
<p>This coursework alone is not intended to make you a GPU
expert. You should know how to create an OpenCL program
from scratch by the end, but the performance you get
may not be be as high as a TBB version.</p>
<p>This builds on your existing knowledge of iteration spaces,
and your experience with <code>tbb::parallel_for</code>. There are
also links to the dependencies you've been seeing when
implementing things using <code>tbb::task_group</code>, but now
there is much less safety.</p>
<h1><a id="user-content-checking-your-opencl-environment" class="anchor" aria-hidden="true" href="#checking-your-opencl-environment"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Checking your OpenCL environment</h1>
<p>Before writing any code, it is worth checking your OpenCL environment
and SDK, just to check that you have the right devices and things
installed. There is a file called <code>src/test_opencl.cpp</code>, which is
a simple, but complete, OpenCL program. It doesn't do a lot, but
it does allocate GPU buffers and try to execute a kernel, which
is enough to tell whether things are up and running.</p>
<p>Compile the program:</p>
<pre><code>make bin/test_opencl
</code></pre>
<p>and make sure you can both build and execute it. You may need to
fiddle with your environment to make it build, and find/download an SDK.
While an OpenCL run-time is installed in most systems,
there is often no SDK installed.</p>
<h2><a id="user-content-sdks-and-run-times" class="anchor" aria-hidden="true" href="#sdks-and-run-times"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SDKs and Run-times</h2>
<p>As with TBB, you need two parts: the OpenCL SDK, which gives
the headers and libraries you need to compile your programs;
and the OpenCL run-time, which provides access to the
underlying compute resource and does all the scheduling.</p>
<h3><a id="user-content-cross-platform" class="anchor" aria-hidden="true" href="#cross-platform"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cross-platform</h3>
<p>In 2014 @farrell236 was nice enough to contribute the <a href="/HPCE/hpce-2018-cw3/blob/master/CMakeLists.txt">CMakeLists.txt</a>,
which is a way of getting cross-platform builds with CMake. I've
kept it here, as exposure to CMake is a good thing (I've seen
quite a few students (EIE2 2016 onwards) using <a href="https://www.jetbrains.com/clion/" rel="nofollow">CLion</a>,
which is based on CMake).</p>
<h3><a id="user-content-linux" class="anchor" aria-hidden="true" href="#linux"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Linux</h3>
<p>You should be able to get a working OpenCL driver via your
GPU vendor - often that will come with an SDK as well. If
you don't have a GPU, or it isn't supported, you can try
using a software OpenCL implementation. Intel provide a
multi-core version, and the AMD OpenCL run-time also contains
a software version, though you'll need to be root to
install it.</p>
<p>Many DoC machines have NVidia cards, with the OpenCL
drivers installed.</p>
<p>If you want to use the Intel OpenCL provided under Ubuntu, then @TheoFranquet
had some <a href="https://github.com/HPCE/hpce-2018-cw3/issues/45">suggestions on how to get it setup</a>.</p>
<h3><a id="user-content-mac-users" class="anchor" aria-hidden="true" href="#mac-users"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mac users</h3>
<p>As far as I know all Macs come with OpenCL installed these
days, but the SDK may not be installed. I would imagine you
can bring the SDK over with whatever package managed OSX
has, as Apple are very integrated into the whole OpenCL thing.</p>
<p>Apparently, adding the option:</p>
<pre><code>-framework OpenCL
</code></pre>
<p>to your compilation may help when trying to sort out header
and linker directories.</p>
<h3><a id="user-content-aws" class="anchor" aria-hidden="true" href="#aws"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS</h3>
<p>I've created an image for AWS which has OpenCL set up,
both for software and the GPU. The title of the image
is <code>HPCE-2018</code>, which can be selected when
you launch an AWS instance. The instance is located
in the "N. Virginia" region - if you can't find it, check
whether AWS has defaulted you into a different region.</p>
<p>This is an ubuntu image, so the default login is <code>ubuntu</code>
So you would login with ssh as:</p>
<pre><code>ssh -A -i [your-key] admin@[server-ip-address]
</code></pre>
<p>I will be using a <code>g3.4xlarge</code> instance for assessment. It's
probably a good idea for you to test your work on one of these
prior to submission.</p>
<h3><a id="user-content-debugging" class="anchor" aria-hidden="true" href="#debugging"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging</h3>
<p>Because the program you're writing works as part of a pipeline,
you may find it difficult to launch in a debugger. You have a
couple of options here:</p>
<ul>
<li>
<p>If your pipeline is <code>./A | ./B | ./C</code> and you want to debug
program <code>B</code>, store the output of A into a file <code>./A &gt; a.out</code>.
In the debugger you are using, specifying that stdin should
come from the file.</p>
</li>
<li>
<p>Use the "deferred launch" feature available in some debuggers.
In this mode you tell the debugger what program you want to
debug, and it will wait till it sees that program start then
attach to it.</p>
</li>
<li>
<p>Use the "attach to process" feature available in most debuggers.
Add something to interrupt execution at the start of main, for
example <code>raise(SIGSTOP)</code> (posix/Mac) or <code>DebugBreak()</code> (Windows),
then you can attach the debugger.</p>
<ul>
<li><a href="http://blogs.msdn.com/b/calvin_hsia/archive/2006/08/25/724572.aspx" rel="nofollow">http://blogs.msdn.com/b/calvin_hsia/archive/2006/08/25/724572.aspx</a></li>
<li><a href="https://developer.apple.com/library/mac/qa/qa1573/_index.html" rel="nofollow">https://developer.apple.com/library/mac/qa/qa1573/_index.html</a></li>
</ul>
</li>
</ul>
<h1><a id="user-content-the-heat-world-code" class="anchor" aria-hidden="true" href="#the-heat-world-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Heat World code</h1>
<p>To make this somewhat realistic, you are working with an
existing proprietary application. The overall structure is a classic
example of a <a href="https://en.wikipedia.org/wiki/Finite_difference_method" rel="nofollow">finite-difference</a>
or stencil operation, where
you are applying some sort of local smoothing operation
over huge numbers of time-steps. Such stencil calculations are
very common, but different enough that one often can't use
an off-the-shelf piece of software. Application areas where
they arise include:</p>
<ul>
<li>
<p>Electric and magnetic field models</p>
</li>
<li>
<p>Percolation and diffusion of dopants</p>
</li>
<li>
<p>Temperature propagation within devices and heat-sinks</p>
</li>
<li>
<p>Computational finance</p>
</li>
</ul>
<p>The core of the code is in the two files <code>include/heat.hpp</code> and
<code>src/heat.cpp</code>, with the header giving the API for creating, storing,
loading, and stepping a model of a heat system.</p>
<p>As well as the core <code>src/heat.cpp</code>, there are also a number of
driver programs:</p>
<ul>
<li>
<p><code>src/make_world.cpp</code> : Creates a new two-dimensional model, and
gives it an initial state.</p>
</li>
<li>
<p><code>src/step_world.cpp</code> : Reads a world from a file, and advances
it by a chosen number of time-steps.</p>
</li>
<li>
<p><code>src/render_world.cpp</code> : Takes the current state of the world,
renders it to a bitmap.</p>
</li>
</ul>
<p>Each of these source files must be compiled together with <code>heat.cpp</code>
to produce an executable. There are no other dependencies on external
libraries.</p>
<p>Use your chosen development environment to compile the three files,
resulting in <code>bin/make_world</code>, <code>bin/step_world</code> and <code>bin/render_world</code> (you
can have them build in whatever directory you like). If you now
do:</p>
<pre><code>bin/make_world 10 0.1
</code></pre>
<p>You'll see it create a text description of a heat world (you
may want to make your terminal larger, or look at it in a text
file. At the top is the header, describing the dimensions of the world, and
the propagation constant (0.1 in this case). The propagation
constant measures how fast heat migrates between conductive
cells in this world, so a constant of 0.01 would result in slower
movement of heat.</p>
<p>Below the header you'll see a grid of 0, 1, and 2, defining
the shape of the world. Any 2s represent insulator, where
heat cannot flow, while any 1s represents fixed temperature
cells, such as heat-sinks and heat-sources. All the 0s are
"normal" conductive cells.</p>
<p>Below the world grid is the current temperature or state of every
cell in the grid, with values between 0 and 1. After creating
the world it is cold, except for a row of 1s near the top
of the state which are all hot. If you compare these cells
with the world grid, you'll see these 1s are fixed, so they
will keep their value of 1 as time progresses. However,
surrounding cells will change temperature in response to
the cells around them.</p>
<p>Now advance the world by a single time-step of length 0.1 seconds:</p>
<pre><code>bin/make_world 10 0.1 | bin/step_world 0.1 1
</code></pre>
<p>You'll see that the the cells next to the heat source row have
warmed up. The warming is not uniform, as at the far left and
far right the cells are up against insulators, so according
to the simple model using here, they end up slightly warmer.</p>
<p>You can now advance the world by a few seconds:</p>
<pre><code>bin/make_world 10 0.1 | bin/step_world 0.1 100
</code></pre>
<p>You should see that some of the heat is making it's way
around the right hand side, but it can't come through
the insulator across the middle-left. Step forward
by 1000 seconds:</p>
<pre><code>bin/make_world 10 0.1 | bin/step_world 0.1 10000
</code></pre>
<p>and you'll see the world has largely reached a steady-state,
with high temperatures around the top, then slowly
decreasing temperatures through to the single point heat-sink
at the bottom.</p>
<p>In such problems we are usually interested in looking
at very high spatial resolutions (i.e. lots of cells),
and very fine temporal resolutions. This sort of discretisation
is most accurate when both time and space are very
fine. To visualise much finer-grain scenarios, it is
convenient to view it as a bitmap:</p>
<pre><code>bin/make_world 100 0.1 | bin/step_world 0.1 100 | bin/render_world dump.bmp
</code></pre>
<p>If you look at <code>dump.bmp</code>, you should see insulators rendered
in green, and the temperature shown from blue (0) to red (1). However,
over a total time of 0.1*100=10 seconds, very little will have happened.
To see anything happen, you'll need to up the time significantly:</p>
<pre><code>bin/make_world 100 0.1 | bin/step_world 0.1 100000 | bin/render_world dump.bmp
</code></pre>
<p>It is getting fairly slow, even at a resolution of 100x100, but in
practise we'd like to increase resolution 10x in all three dimensions
(both spatial axes + time), which increases the compute time by
a factor of 1000.</p>
<p>This type of computation is ideal for a GPU, as it maps very
well to the grid-structure provided by both the hardware
and the programming model.</p>
<h1><a id="user-content-preparing-the-code-for-opencl" class="anchor" aria-hidden="true" href="#preparing-the-code-for-opencl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preparing the code for OpenCL</h1>
<p>Create a new folder within <code>src</code> called <code>src/your_login</code>. This is
where your additional code will live (as before, in principle I
should be able to compile everyone in the classes's code together
at the end).</p>
<p>We're going to convert the original C++ code to OpenCL quite
incrementally, keeping a trail of working versions as we go.
You should keep track of this as labels within git, so
that you can always get back to a working version, and
work out what you changed that broke it (however, I don't
<em>require</em> you to do this).
If all you have is the original sequential and the highly optimised
parallel GPU version, then it can be very difficult to see how the
two are actually related.</p>
<h3><a id="user-content-examining-the-source-code" class="anchor" aria-hidden="true" href="#examining-the-source-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examining the source code</h3>
<p>The first thing to do is to look at the source code,
and to identify opportunities for parallelism. If
you open <code>src/heat.cpp</code>, you'll see a number of
functions, but the computationally intensive part is
the function <code>hpce::StepWorld</code>. This is responsible
for moving the world forwards by <code>n</code> steps which each
increment time by <code>dt</code>.</p>
<p>Within <code>StepWorld</code> there is some initial setup
which allocates buffers and calculates constants,
followed three nested loops. These loops
represent the bulk of the time in the algorithm, and
it should be clear that the execution time complexity
is O(<code>n</code> x <code>w</code> x <code>h</code>). So broadly speaking if we double any <em>one</em>
of <code>n</code>, <code>w</code>, or <code>h</code> then the execution time will double, and
if we double <em>all</em> of <code>n</code>, <code>w</code>, and <code>h</code> then the execution
time will be eight times longer.</p>
<p>Recalling your experience with TBB, you should
immediately see opportunities
for parallelism here: all the iterations of the
two inner loops are independent, and so can be
parallelised. However, there is a loop carried
dependency across the time loop, similar to the
erode filter we looked at in lectures. However,
unlike the erode example, where there were multiple
frames which could be pipelined, here we have
a single world to update, so pipelining will not
help.</p>
<h3><a id="user-content-extracting-the-inner-loop-to-a-lambda" class="anchor" aria-hidden="true" href="#extracting-the-inner-loop-to-a-lambda"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extracting the inner loop to a lambda</h3>
<p>First we want to isolate the part of the program
that will be moved to the GPU. Because the GPU works
in a different memory space, it is useful to emulate
that hard boundary in software first, before starting
to convert to kernels.</p>
<h4><a id="user-content-writing-the-code" class="anchor" aria-hidden="true" href="#writing-the-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing the code</h4>
<p>Take the file <code>src/heat.cpp</code>, and copy it to a new
file called <code>src/your_login/step_world_v1_lambda.cpp</code>.
The original file contains multiple support and IO functions
which we aren't interested in (we'll still be linking with
the original <code>src/heat.cpp</code>, so cut out all the functions
which aren't <code>StepWorld</code>. Rename the remaining <code>StepWorld</code>
to <code>StepWorldV1Lambda</code>, and put it in a namespace called
<code>your_login</code>. So you should be left with a file which looks
something like:</p>
<pre><code>#include "heat.hpp"

... // More include files

namespace hpce{
namespace your_login{

void StepWorldV1Lambda(world_t &amp;world, float dt, unsigned n)
{
	... // Existing implementation
}

}; // namespace your_login
}; // namespace hpce
</code></pre>
<p>Our first step is to pull the two inner loops out into
a lambda, starting to isolate the core loops. Pull
the body of the inner-most loop into a seperate
lambda called <code>kernel_xy</code>, which should take an
<code>x</code> and <code>y</code> parameter, but capture everything else by
reference (i.e. use the <code>[&amp;]</code> lambda form) - this
is an intermediate step, so we won't worry too much
about shared dynamic state.</p>
<p>The resulting code should look <em>something</em> like:</p>
<pre><code>std::vector&lt;float&gt; buffer(w*h);

auto kernel_xy = [&amp;](unsigned x, unsigned y)
{
	... // Original loop body
};

for(unsigned t=0;t&lt;n;t++){
    for(unsigned y=0;y&lt;h;y++){
        for(unsigned x=0;x&lt;w;x++){
            kernel_xy(x,y);
        }  // end of for(x...
    } // end of for(y...
	
	... // Rest of code
</code></pre>
<p>Note that the lambda has to be declared after
<code>buffer</code>, as if you try to declare it before, then
it is impossible to close over the variable - you
can't refer to something that hasn't been named
yet.</p>
<h4><a id="user-content-building-the-test-framework" class="anchor" aria-hidden="true" href="#building-the-test-framework"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building the test framework</h4>
<p>To compile this, we need some sort of driver
program to load the world, call our function,
and save the world. Fortunately, we already have
such a program in <code>src/step_world.cpp</code>. Take the
<code>main</code> from that program (<code>src/step_world.cpp</code>) and paste it in below
your existing code. Note that it should appear
outside the namespaces, as <code>main</code> goes
in the global namespace. Modify the call to <code>hpce::StepWorld</code>
to <code>hpce::your_login::StepWorldV1Lambda</code>, to ensure
it uses your new function.</p>
<p>Modify your build environment so that <code>src/heat.cpp</code> is
compiled together with <code>src/your_login/step_world_v1_lambda.cpp</code>
to produce a single executable called <code>step_world_v1_lambda</code>.
Again, it is up to you where you choose to have it built.</p>
<p>_If you are using the default makefile, then doing:</p>
<pre><code>make bin/your_login/step_world_v1_lambda
</code></pre>
<p>should build it through the magic of pattern matching, then you
can run it as:</p>
<pre><code>bin/your_login/step_world_v1_lambda
</code></pre>
<p>_</p>
<p>By making sure the executables have different names
we can still run old versions, and we retain the ability
to select between different implementations. Often
students - I'm sure not you - resort to #ifdef and
commented out code as they develop new versions of
existing code. This is an alternative approach to that
taking in CW1 and CW2: instead of having a switch that
allows one program to have multiple implementations,
we have multiple programs that can be switched in and
out of a pipeline.</p>
<p>Test your program still does the same as the
original implementation in whatever way you
think best. Note that you have both
<code>step_world</code> and <code>step_world_v1_lambda</code>
available at the same time, and that there
are programs like <code>diff</code> (posix) which will
tell you if two text files are
different. In bash this is particularly easy to do,
and it can be incorporated into your makefile if you
wish - <code>make test</code> is often a good target to have.</p>
<h3><a id="user-content-making-the-isolation-clean" class="anchor" aria-hidden="true" href="#making-the-isolation-clean"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making the isolation clean</h3>
<p>Your lambda version captures everything by
reference, so within <code>kernel_xy</code> there are
references to <code>world</code>, <code>buffer</code>, and so on.
For the GPU version the kernel cannot make
any references to things which are not explictly
passed as parameters, and the best way of
emulating this is to move the kernel outside
the stepping function into a pure function.
In this context, "pure function" means a function
that is only able to interact with the world
via its parameters, and accesses no global
state or captured variables.</p>
<p>OpenCL also doesn't allow complex C++ data-types
to cross the CPU-GPU boundary, so we'll also
need to convert those to primitive types or
pointers to primitive types. For example, the
kernel currently closes over (captures) <code>world</code> which is
of type <code>world_t</code>, and <code>buffer</code>, which has type
<code>std::vector&lt;float&gt;</code>. These need to be turned
into parameters with primitive types and known size, such as
<code>uint32_t</code>, <code>float</code>, and/or pointers to those
types.</p>
<p>Based on your <code>step_world_v1_lambda.cpp</code> code, create
a new file called <code>step_world_v2_function.cpp</code> in the
same directory, and rename the inner function to
<code>hpce::your_login::StepWorldV2Function</code>. Make sure you
can build and run the file before proceeding.</p>
<p>Currently it will have a lambda called <code>kernel_xy</code>; take
the lambda outside the <code>StepWorldV2Function</code>, and
make it a new function called <code>kernel_xy</code>:</p>
<pre><code>// Note the change from unsigned -&gt; uint32_t to get a known size type
void kernel_xy(uint32_t x, uint32_t y)
{
    ... // Original lambda body
}

void StepWorldV2Function(world_t &amp;world, float dt, unsigned n)
{
    ... // Original code, now without lambda
</code></pre>
<p>If you try compiling this, you'll see that it doesn't
work - you'll get undefined errors about <code>w</code>, <code>world</code>,
and so on. This is telling you all the information/data/memory/structures
which will eventually have to be manually copied to
the GPU, and if necessary back again afterwards. When
accelerating for real, this
is a good point to think about communication costs - have
you really chosen the best point
to cut the program at? Are there any things being copied
across which could more cheaply be recalculated within
the kernel?</p>
<p>Resolve all these errors by adding parameters to the
definition of <code>kernel_xy</code>, and by adding arguments
to the point where <code>kernel_xy</code> is called. For example,
to resolve the error with <code>w</code>, you would modify
the declaration:</p>
<pre><code>void kernel_xy(uint32_t x, uint32_t y, uint32_t w);
</code></pre>
<p>and then use:</p>
<pre><code>for(unsigned x=0;x&lt;w;x++){
	kernel_xy(x,y, w);
}  // end of for(x...
</code></pre>
<p>Note that some things will require conversion from C++
types to primitive types. For example to convert <code>world.state</code>,
you'll need to pass a pointer to the data:</p>
<pre><code>void kernel_xy(uint32_t x, uint32_t y, uint32_t w, const float *world_state);
</code></pre>
<p>and:</p>
<pre><code>for(unsigned x=0;x&lt;w;x++){
	kernel_xy(x,y, w, &amp;world.state[0]);
}  // end of for(x...
</code></pre>
<p>I used "const" on the world_state parameter to indicate that
it is never modified inside the kernel. However, the
converted <code>buffer</code> parameter cannot be const, as the kernel
must write to the array to produce output. This process
helps show which arrays must be copied both to and from
the GPU, and which only need to be copied one way.</p>
<p>When it comes to passing the cell properties, note that
cell_flags_t was originally defined to have the underlying
type <code>uint32_t</code>, so you can safely cast to a <code>(const uint32_t *)</code> when
converting parameters.</p>
<p>Keep adding parameters until you have removed all errors,
making sure that you convert all of them to primitive
types or pointers to arrays of primitive types.</p>
<p>Test the function to make sure it still works. If so, we
are now in a position to map it into a CPU kernel.</p>
<h1><a id="user-content-initial-conversion-to-opencl-v3" class="anchor" aria-hidden="true" href="#initial-conversion-to-opencl-v3"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initial conversion to OpenCL (v3)</h1>
<p>We've now got a version of the code which has
separated the computationally intensive part out
into a function. This function has:</p>
<ul>
<li>
<p>An iteration identifier (<code>x</code>,<code>y</code>), which identifies where
the computation is occurring within the overall parallel
iteration space. This will become our OpenCL global work id,
which is unique for all work-items in the kernel.</p>
</li>
<li>
<p>A number of scalar (non-pointer) parameters, such
as <code>w</code>, which will be passed by value at the kernel invocation.</p>
</li>
<li>
<p>A number of non-scalar (pointer) parameters, which will
need to be manually copied to the GPU before kernel execution,
passed by reference when we invoke the kernel, and then
manually copied back after execution finishes.</p>
</li>
</ul>
<p>To convert this to OpenCL, first we'll handle the
host code (the long boring bit), then look at the
GPU kernel. We'll do all this in a file called
<code>src/your_login/step_world_v3_opencl.cpp</code>, with
a function called <code>src::your_login::StepWorldV3OpenCL</code>.</p>
<p>Create the new file based on the <code>src/your_login/step_world_v2_function.cpp</code> code,
and check you can still build and run it. While we're
setting up the OpenCL parts, don't worry too much about
the data going in and out. You can simply test it using
something equivalent to:</p>
<pre><code>bin/make_world | bin/step_world_v3_opencl &gt; /dev/null
</code></pre>
<p>as for a while we'll just look at stderr.</p>
<h3><a id="user-content-opening-the-context-compiling-kernels" class="anchor" aria-hidden="true" href="#opening-the-context-compiling-kernels"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Opening the context, compiling kernels</h3>
<p>Because OpenCL supports many devices, there are
a number of stages involved in starting things
up and connecting to various devices. Before
we even think about executing kernels, we need to:</p>
<ol>
<li>
<p>Choose an OpenCL platform, as there might
be multiple platforms available in one
machine. For example, there may be both
Intel and NVidia platforms installed.</p>
</li>
<li>
<p>Select one of the devices exposed by the
platform. As an example, the AMD platform
may expose both CPU and GPU OpenCL devices.</p>
</li>
<li>
<p>Create an OpenCL context for the platform,
which describes the environment within which
we can launch kernels and manage memory buffers.</p>
</li>
<li>
<p>Create and build our kernels. It is common
to load and build the GPU kernel code at run-time,
just before the kernel is first used, though it is
also possible to pre-compile them (pre-compilation is
required for FPGA-based OpenCL providers).</p>
</li>
</ol>
<p>These steps can often be simplified with library
code, but here we'll rely on just the standard
OpenCL C++ wrappers. These bindings come from
<code>CL/cl.hpp</code>, and are installed in most recent
OpenCL SDKs, but just in case, there is a version
in the <code>include</code> directory too. The functions provided
by this header are all documented at the <a href="http://www.khronos.org/registry/cl/specs/opencl-cplusplus-1.2.pdf" rel="nofollow">Khronos site</a>.</p>
<p>Add the include at the top of <code>src/your_login/step_world_v3_opencl.cpp</code>:</p>
<pre><code>#define CL_USE_DEPRECATED_OPENCL_1_2_APIS
#define __CL_ENABLE_EXCEPTIONS 
#include "CL/cl.hpp"
</code></pre>
<p>The <code>__CL_ENABLE_EXCEPTIONS</code> definition tells the C++
wrapper that it should throw exceptions when things
go wrong, rather than just returning an error code.
This makes it much harder to accidentally ignore steps
which went wrong. The deprecation macro is because NVidia
still does not seem to officially support OpenCL 2.0, so we are
working with 1.2 as a lowest common denominator.</p>
<p>At this point you may hit an error about <code>CL/opencl.h</code> not
being found. Make sure that OpenCL is available, and that
you have appropriately modified your include directories
to point towards the include files in the OpenCL SDK.
Assuming the initial <code>test_opencl.cpp</code> program compiled
this should work fine.</p>
<h4><a id="user-content-choosing-a-platform" class="anchor" aria-hidden="true" href="#choosing-a-platform"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing a platform</h4>
<p>We'll add the generic OpenCL initialisation at the start of
<code>StepWorldV3OpenCL</code>, before doing anything with the world-specific
code. First get a list of platforms from OpenCL:</p>
<pre><code>std::vector&lt;cl::Platform&gt; platforms;
	
cl::Platform::get(&amp;platforms);
if(platforms.size()==0)
	throw std::runtime_error("No OpenCL platforms found.");
</code></pre>
<p>After this code executes we'll have a list of installed
platforms, which we can print the names of (in production
code you would comment this out or make it optional):</p>
<pre><code>std::cerr&lt;&lt;"Found "&lt;&lt;platforms.size()&lt;&lt;" platforms\n";
for(unsigned i=0;i&lt;platforms.size();i++){
	std::string vendor=platforms[i].getInfo&lt;CL_PLATFORM_VENDOR&gt;();
	std::cerr&lt;&lt;"  Platform "&lt;&lt;i&lt;&lt;" : "&lt;&lt;vendor&lt;&lt;"\n";
}
</code></pre>
<p>At this point we could select just the first platform,
but it is nice to be able to provide a way to select
a specific platform. Often this would be by a configuration
file, but we'll do it by an environment variable:</p>
<pre><code>int selectedPlatform=0;
if(getenv("HPCE_SELECT_PLATFORM")){
	selectedPlatform=atoi(getenv("HPCE_SELECT_PLATFORM"));
}
std::cerr&lt;&lt;"Choosing platform "&lt;&lt;selectedPlatform&lt;&lt;"\n";
cl::Platform platform=platforms.at(selectedPlatform);    
</code></pre>
<p>This means that by default it will select the first platform,
but if we change an environment variable (e.g. <code>export HPCE_SELECT_PLATFORM=1</code>
in bash), then the executable will do something different.
While not as good as a configuration file, this makes it
possible to select what happens <em>without</em> recompiling. Again,
I'm sure you don't use <code>#ifdef</code> and commenting to change
functionality, but many less enlightened students do.</p>
<p>We now have a handle to our chosen platform in <code>platform</code>. This
handle will automatically be deleted when the object
goes out of scope, so there is no explicit handle management
needed.</p>
<h4><a id="user-content-choose-a-device" class="anchor" aria-hidden="true" href="#choose-a-device"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choose a device</h4>
<p>Within the platform there might be multiple devices, which
we can enumerate:</p>
<pre><code>std::vector&lt;cl::Device&gt; devices;
platform.getDevices(CL_DEVICE_TYPE_ALL, &amp;devices);	
if(devices.size()==0){
	throw std::runtime_error("No opencl devices found.\n");
}
	
std::cerr&lt;&lt;"Found "&lt;&lt;devices.size()&lt;&lt;" devices\n";
for(unsigned i=0;i&lt;devices.size();i++){
	std::string name=devices[i].getInfo&lt;CL_DEVICE_NAME&gt;();
	std::cerr&lt;&lt;"  Device "&lt;&lt;i&lt;&lt;" : "&lt;&lt;name&lt;&lt;"\n";
}
</code></pre>
<p>Depending on your system you may now see two devices. On my
desktop, I get:</p>
<pre><code>dt10@TOTO /cygdrive/e/_dt10_/documents/teaching/2016/hpce/cw/CW3
$ bin/make_world.exe 64 | bin/step_world_v3_opencl &gt; /dev/null
Loaded world with w=64, h=64
Stepping by dt=0.1 for n=1
Found 1 platforms
  Platform 0 : Advanced Micro Devices, Inc.
Choosing platform 0
Found 2 devices
  Device 0 : Caicos
  Device 1 :         Intel(R) Core(TM) i7-2600 CPU @ 3.40GHz
</code></pre>
<p>This shows I have one GPU device (Caicos), and one CPU device.
Within each device there may be multiple CPUs, but here
OpenCL is just listing the physical clusters available.</p>
<p>Despite one of these devices being a CPU, remember that it
is just as valid OpenCL device as a GPU. It is often
not as fast or powerful, but it can still be programmed
in the same way. However, on a multi-core machine the
CPU OpenCL device may in fact be very powerful, with the
ability to exploit wide SIMD instructions. Do not
under-estimate the power of a <a href="http://aws.amazon.com/ec2/instance-types/" rel="nofollow">c5.9xlarge</a>
running all 36 cores over vectorisable code, as it can
often beat a GPU.</p>
<p>As before we'll select device 0 by default, but give the
option of changing that via an environment variable:</p>
<pre><code>int selectedDevice=0;
if(getenv("HPCE_SELECT_DEVICE")){
	selectedDevice=atoi(getenv("HPCE_SELECT_DEVICE"));
}
std::cerr&lt;&lt;"Choosing device "&lt;&lt;selectedDevice&lt;&lt;"\n";
cl::Device device=devices.at(selectedDevice);
</code></pre>
<p>So for example I can switch between device 0 and 1 without
re-compiling:</p>
<pre><code>dt10@TOTO /cygdrive/e/_dt10_/documents/teaching/2016/hpce/cw/CW3
$ bin/make_world.exe 64 | bin/step_world_v3_opencl &gt; /dev/null
Loaded world with w=64, h=64
Stepping by dt=0.1 for n=1
Found 1 platforms
  Platform 0 : Advanced Micro Devices, Inc.
Choosing platform 0
Found 2 devices
  Device 0 : Caicos
  Device 1 :         Intel(R) Core(TM) i7-2600 CPU @ 3.40GHz
Choosing device 0

dt10@TOTO /cygdrive/e/_dt10_/documents/teaching/2016/hpce/cw/CW3
$ export HPCE_SELECT_DEVICE=1

dt10@TOTO /cygdrive/e/_dt10_/documents/teaching/2016/hpce/cw/CW3
$ bin/make_world.exe 64 | bin/step_world_v3_opencl &gt; /dev/null
Loaded world with w=64, h=64
Stepping by dt=0.1 for n=1
Found 1 platforms
  Platform 0 : Advanced Micro Devices, Inc.
Choosing platform 0
Found 2 devices
  Device 0 : Caicos
  Device 1 :         Intel(R) Core(TM) i7-2600 CPU @ 3.40GHz
Choosing device 1
</code></pre>
<h4><a id="user-content-creating-a-context" class="anchor" aria-hidden="true" href="#creating-a-context"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a context</h4>
<p>To actually make use of the device, we need to create an
OpenCL context, which represents a domain within which
we can create and use kernels and memory buffers. Each
object can only be used within the context it was created
for, and it is unusual to have more than one context
in existence at a time (though it is legal).</p>
<p>Contexts can actually cover multiple devices (though
we won't use that ability here), so to create a
context we pass a vector of devices. Conveniently,
we still have such a vector in <code>devices</code> from when
we enumerated the devices, which we can use to
construct the context:</p>
<pre><code>cl::Context context(devices);
</code></pre>
<p>That's about it for creating the context - it doesn't
do a lot, but we need it as a parameter to all the
kernel and memory buffer functions coming up.</p>
<h4><a id="user-content-loading-and-building-a-kernel" class="anchor" aria-hidden="true" href="#loading-and-building-a-kernel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Loading and building a kernel</h4>
<p>The system is now pretty much initialised, and we can
start doing application specific stuff. The first thing
we want to do is create and compile our kernels. Each
kernel is a piece of code compiled for the GPU, which can
then be launched over a particular iteration space. But
before writing the kernel, we'll write the host code
to load and compile it.</p>
<p>Kernel code often exists as text files outside the program,
and it is largely up to the user to get the text of
the source code - OpenCL doesn't know or care where it
comes from. Finding and locating this code at run-time
can be a pain, and it is not uncommon to embed them
as resources within the executable. For the purposes
of this coursework we will assume that all cl code is
in the <code>src/your_login</code> directory. So for example, the opencl
code for this particular executable will eventually be
placed at <code>src/your_login/step_world_v3_kernel.cl</code>.
However, as a get-out, we will again define an
environment variable called <code>HPCE_CL_SRC_DIR</code> which
can be used to override that at run-time.</p>
<p>Having defined where the code will be found, the
first thing to do is load the file contents. This is
trivial, but worth knowing how to do simply, so briefly
read this, then integrate it into your file:</p>
<pre><code>// To go at the top of the file
#include &lt;fstream&gt;
#include &lt;streambuf&gt;

// To go in hpce::your_login, just above StepWorldV3OpenCL
std::string LoadSource(const char *fileName)
{
	// TODO : Don't forget to change your_login here
	std::string baseDir="src/your_login";
	if(getenv("HPCE_CL_SRC_DIR")){
		baseDir=getenv("HPCE_CL_SRC_DIR");
	}
	
	std::string fullName=baseDir+"/"+fileName;
	
	// Open a read-only binary stream over the file
	std::ifstream src(fullName, std::ios::in | std::ios::binary);
	if(!src.is_open())
		throw std::runtime_error("LoadSource : Couldn't load cl file from '"+fullName+"'.");
	
	// Read all characters of the file into a string
	return std::string(
		(std::istreambuf_iterator&lt;char&gt;(src)), // Node the extra brackets.
        std::istreambuf_iterator&lt;char&gt;()
	);
}
</code></pre>
<p>We need to collect together sources into a <em>program</em>, which
is the unit of compilation in OpenCL. In our case it
will only contain one kernel, but in principle there could
be many kernels, spread across multiple sources. So, returning to
where we left off, just after creating the context:</p>
<pre><code>std::string kernelSource=LoadSource("step_world_v3_kernel.cl");

cl::Program::Sources sources;	// A vector of (data,length) pairs
sources.push_back(std::make_pair(kernelSource.c_str(), kernelSource.size()+1));	// push on our single string

cl::Program program(context, sources);
program.build(devices);
</code></pre>
<p>At this point you should be able to compile and run the overall
program, but it should crash because there is no such kernel.</p>
<h4><a id="user-content-writing-a-kernel" class="anchor" aria-hidden="true" href="#writing-a-kernel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing a kernel</h4>
<p>OpenCL host code (what we were just doing in C++) and
OpenCL kernel code is written in a different language, so
we need to create a new file to represent it. Create
a file called <code>src/your_login/step_world_v3_kernel.cl</code>, and
copy the entire <code>kernel_xy</code> function into it. You can
leave the original <code>kernel_xy</code> function where it is, so
that the software path still works.</p>
<p>Your file <code>src/your_login/step_world_v3_kernel.cl</code> should
now look something like (your parameters may be in a different
order):</p>
<pre><code>void kernel_xy(unsigned x, unsigned y,
	unsigned w,
	float inner, float outer,
	const uint32_t *properties,
	const float *world_state,
	float *buffer
	)
{
	unsigned index=y*w + x;
	
	... // Rest of code
}
</code></pre>
<p>Kernel functions are prefixed with <code>__kernel</code>, so as a minimum
step towards creating a working kernel, change the function
type in the cl file to:</p>
<pre><code>__kernel void kernel_xy(unsigned x, unsigned y, // Rest of kernel...
</code></pre>
<p>Try running your C++ program again. It should now be able
to find the file, but then OpenCL will throw an exception
when it tries to compile it. The underlying cause is
syntax errors, just as with a malformed C program, but
here we can't see them.</p>
<p>To expose the specific error messages, go back to the
C++ file and modify the build statement to the following:</p>
<pre><code>cl::Program program(context, sources);
try{
	program.build(devices);
}catch(...){
	for(unsigned i=0;i&lt;devices.size();i++){
		std::cerr&lt;&lt;"Log for device "&lt;&lt;devices[i].getInfo&lt;CL_DEVICE_NAME&gt;()&lt;&lt;":\n\n";
		std::cerr&lt;&lt;program.getBuildInfo&lt;CL_PROGRAM_BUILD_LOG&gt;(devices[i])&lt;&lt;"\n\n";
	}
	throw;
}
</code></pre>
<p>This code is catching the error being thrown, and
then extracting the build log for each device. If
you run it again, you should see a whole bunch
of complaints.</p>
<p>You'll see a number of errors, most likely including:</p>
<ul>
<li>
<p><code>uint32_t</code> is undefined : In the c/c++ world, unsigneds
and integers have a platform specific width, so
we chose <code>uint32_t</code> to give it a width. However, in
the OpenCL kernel, the uint type is defined a 32-bit
integer on all platforms, so we can substitute <code>uint</code>
for <code>uint32_t</code>.</p>
</li>
<li>
<p>Pointers must have an address space : the compiler
needs to know where pointers can possibly point,
and how they might be shared. We'll use global
memory to start with, so add the <code>__global</code> anotation
to the pointer parameters.</p>
</li>
<li>
<p><code>Cell_Fixed</code> is not defined. These definitions were
not brought over from the C++, so simply add
enum definitions to the .cl file:</p>
<pre><code>  enum cell_flags_t{
  	Cell_Fixed		=0x1,
  	Cell_Insulator	=0x2
  };
</code></pre>
</li>
<li>
<p><code>std::min</code> is not defined. OpenCL contains a number of
equivalent built-ins such as min, max, sin, and cos,
for use in kernels. You can simply delete the <code>std::</code>
part to get the builtin function.</p>
</li>
</ul>
<p>After dealing with the errors, the code should now
happily build. However, we are not done yet, as unlike
<code>tbb::parallel_for</code>, the iteration space for
OpenCL is embedded directly in the language. So
rather than passing <code>x</code> and <code>y</code> as parameters, we
will need to get the indices out of special indexing
registers.</p>
<p>There are two types of builtin indices:</p>
<ul>
<li>
<p><code>size_t get_local_id(uint dimindx)</code> : This returns the position within
the local work-group. Threads within a local work-group can
communicate via local memory, and the size of the local group is
limited by hardware resources.</p>
</li>
<li>
<p><code>size_t get_global_id(uint dimindx)</code> : This returns the position within
the entire global work-group. Threads in different local work-groups
cannot communicate via local memory, but can communicate via
(slower) global memory, and the size of the global work-group is almost
unlimited.</p>
</li>
</ul>
<p>The dimensionality of each id is determined by the dimension
of the iteration space used at launch-time (which is coming up
soon). In this specific case we are using a 2D iteration
space, and our memory pointers are global, so we can extract
the <code>x</code> and <code>y</code> co-ordinates from the global work-group. As well
as the co-ordinates, the run-time and hardware also know the
sizes of the groups via <code>get_local_size</code> and <code>get_global_size</code>,
so we can also remove the <code>w</code> parameter:</p>
<pre><code>__kernel void kernel_xy(
	float inner, float outer,
	__global const uint *properties,
	__global const float *world_state,
	__global float *buffer
	)
{
	uint x=get_global_id(0);
	uint y=get_global_id(1);
	uint w=get_global_size(0);
	
	unsigned index=y*w + x;
	
	... // Original code
</code></pre>
<p>In principle, this should now be a fully working OpenCL kernel!</p>
<h3><a id="user-content-creating-and-executing-kernels" class="anchor" aria-hidden="true" href="#creating-and-executing-kernels"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating and executing kernels</h3>
<p>We now have all the static infrastructure in place,
with our devices and context open, and our OpenCL
code compiled. At this point we have the choice
of starting up multiple tasks which make use of
the program we compiled, as the OpenCL interface
is inherently multi-threaded, and there is nothing
to stop multiple threads or tasks sharing a device.</p>
<p>However, within each thread we would have to make sure
that all OpenCL tasks are synchronised and
co-ordinated with each other (regardless of what
other threads are doing). The mechanism for
doing that is called a <em>command queue</em>, and as
it suggests, it is a queueing or scheduling
structure for issuing commands to the device. These
commands can relate both to data movement between
CPU and GPU, and to the actual execution of kernels
on the GPU. It is essentially a way of building
dependency graphs at run-time, then letting the
GPU execute those graphs in the most efficient
way possible.</p>
<p>To actually execute our kernel, we'll need to follow
these steps:</p>
<ol>
<li>
<p>Allocate on-GPU memory buffers for the non-scalar parameters.</p>
</li>
<li>
<p>Bind any fixed input parameters (e.g. <code>inner</code>) to the kernel.</p>
</li>
<li>
<p>Create a command queue associated with the context.</p>
</li>
<li>
<p>Copy any fixed input data (e.g. <code>properties</code>) to the GPU memory buffers.</p>
</li>
<li>
<p>Bind any dynamic input parameters to the kernel.</p>
</li>
<li>
<p>Copy any input data to the GPU memory buffers.</p>
</li>
<li>
<p>Schedule the kernel onto the command queue. This (finally!) is
where the actual execution happens.</p>
</li>
<li>
<p>Copy any results back from GPU memory buffers.</p>
</li>
</ol>
<h4><a id="user-content-allocating-buffers" class="anchor" aria-hidden="true" href="#allocating-buffers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Allocating buffers</h4>
<p>We have three arrays in use while stepping the world:</p>
<ul>
<li>
<p><code>properties</code> : A read-only array describing the static
structure of the world. This does not change across
all iterations within the world (i.e. for multiple
iterations of the outer <code>t</code> loop).</p>
</li>
<li>
<p><code>state</code> : A read-only array containing the current state
of the world. However, this array does change between
each iteration.</p>
</li>
<li>
<p><code>buffer</code> : A write-only array where we build up the output
of each iteration.</p>
</li>
</ul>
<p>Each of these arrays uses one <code>float</code> or <code>uint32_t</code> per cell,
so the total bytes for each buffer is <code>4*world.w*world.h</code>.
We can allocate space for those arrays on the GPU's local
memory using <code>cl::Buffer</code>. First we'll create the properties
array:</p>
<pre><code>size_t cbBuffer=4*world.w*world.h;
cl::Buffer buffProperties(context, CL_MEM_READ_ONLY, cbBuffer);
cl::Buffer buffState(context, CL_MEM_READ_ONLY, cbBuffer);
cl::Buffer buffBuffer(context, CL_MEM_WRITE_ONLY, cbBuffer);
</code></pre>
<p>So we have now allocated the buffers on the GPU, but don't have
any idea about what data is on them. The flags mentioning READ and WRITE
are hints to the GPU about how the buffers will be used from
the kernel - you can always pass <code>CL_MEM_READ_WRITE</code> and not
think about it, but if you can determine how memory will be
accessed, it is possible the OpenCL runtime can optimise memory
transfers.</p>
<h4><a id="user-content-setting-kernel-parameters" class="anchor" aria-hidden="true" href="#setting-kernel-parameters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting kernel parameters</h4>
<p>It is often the case that some kernel parameters are constant
through multiple uses of the kernel, in which case we
can create the kernel and bind those parameters while
setting things up. In our specific case, all our parameters are
actually fixed, so we can set them all up before entering
the loop (in a later optimisation we will have to modify some
of them as we execute).</p>
<p>To set the kernel parameters, we first have to create
an instance of our kernel which we can set the parameters
on and schedule for execution. Just after the buffers, add:</p>
<pre><code>cl::Kernel kernel(program, "kernel_xy");
</code></pre>
<p>This will find the compiled kernel called <code>kernel_xy</code> in
the program, and create a new instance of it. We may
wish to have multiple instances of the same kernel in
order to schedule parallel copies with different parameters,
but here we need just one.</p>
<p>Parameters are bound to the kernel using the <code>setArg</code> member
function, and are set by index, not name. So we can quickly
go and look in our kernel definition to count off the
indices:</p>
<pre><code>__kernel void kernel_xy(
	float inner,	// 0
	float outer,	// 1
	__global const uint *properties,	// 2
	__global const float *world_state,	// 3
	__global float *buffer	// 4
);
</code></pre>
<p>Don't worry if your kernel parameters are in a different order,
just note which order they occur in.</p>
<p>Given the order, you can then bind the arguments in the C++ code:</p>
<pre><code>kernel.setArg(0, inner);
kernel.setArg(1, outer);
kernel.setArg(2, buffProperties);
kernel.setArg(3, buffState);
kernel.setArg(4, buffBuffer);
</code></pre>
<p>You'll need to make sure that this occurs <em>after</em> the <code>inner</code>
and <code>outer</code> variables are declared, but before the loop is
entered.</p>
<p>The <code>setArg</code> function is overloaded, so it knows how to deal
with scalar parameters such as <code>inner</code> as well as non-scalar
<code>cl::Buffer</code>s like <code>buffState</code>. However, you cannot bind a raw
c++ pointer, such as a <code>float *</code>: at best you will get a compile-time
error, and at worst it will crash unpredictably at run-time.</p>
<h4><a id="user-content-creating-a-command-queue" class="anchor" aria-hidden="true" href="#creating-a-command-queue"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a command queue</h4>
<p>This is our final part of our overall application setup
before moving inside the execution loop. As with the context,
this one is quite simple. After setting the kernel
arguments, simply create a command queue:</p>
<pre><code>cl::CommandQueue queue(context, device);
</code></pre>
<p>Note that the command queue is bound to a single specific
device, even though there may be multiple devices in
our context. That is fine for our purposes, and is
fine as long as you only want to work with one OpenCL
device, but if we wanted to use multiple devices,
we would need multiple command queues.</p>
<h4><a id="user-content-copying-over-fixed-data" class="anchor" aria-hidden="true" href="#copying-over-fixed-data"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Copying over fixed data</h4>
<p>The properties array is constant across all iterations, so
we may as well copy it over to the GPU just once, before
starting the iterations. Copies are scheduled to the
command queue using <code>enqueueWriteBuffer</code>, which copies a
specified area from host (CPU) memory to device (GPU)
memory:</p>
<pre><code>queue.enqueueWriteBuffer(buffProperties, CL_TRUE, 0, cbBuffer, &amp;world.properties[0]);
</code></pre>
<p>The parameters to the function are:</p>
<ul>
<li>
<p><code>buffProperties</code> : The GPU buffer we're writing too.</p>
</li>
<li>
<p><code>CL_TRUE</code> : A flag to indicate we want synchronous operation, so the
function will not complete until the copy has finished.</p>
</li>
<li>
<p><code>0</code> : The starting offset within the GPU buffer.</p>
</li>
<li>
<p><code>cbBuffer</code> : The number of bytes to copy.</p>
</li>
<li>
<p><code>&amp;world.properties[0]</code> : Pointer to the data in host memory we want to copy.</p>
</li>
</ul>
<p>Check that your program still compiles and runs. At this point it should
still perform its normal function using software, but we are about to
rip that out.</p>
<p>So assuming everything compiles and runs, we will now move into
the loop over <code>t</code>. The part we are going to replace
is the double loop over <code>y</code> and <code>x</code>, so:</p>
<ol>
<li>
<p>Check you know what the two loops are doing, and their
loop bounds.</p>
</li>
<li>
<p>Delete both inner loops.</p>
</li>
</ol>
<p>You should be left with just a loop over <code>t</code>, with a
call to <code>std::swap</code> and the time increment at the end. At
this point the program is now broken, until we get
the kernel working.</p>
<h4><a id="user-content-copying-memory-buffers" class="anchor" aria-hidden="true" href="#copying-memory-buffers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Copying memory buffers</h4>
<p>The first thing to do within the loop is to copy the current
state over to the GPU:</p>
<pre><code>cl::Event evCopiedState;
queue.enqueueWriteBuffer(buffState, CL_FALSE, 0, cbBuffer, &amp;world.state[0], NULL, &amp;evCopiedState);
</code></pre>
<p>Unlike the previous copy, we are doing this one asynchronously, shown
by the second parameter being CL_FALSE rather than CL_TRUE. That means
that the call to <code>enqueueWriteBuffer</code> can return even before the
copy has completed. We will have other operations which need the copy
to complete before they can start, so we pass a pointer to <code>evCopiedState</code> to
the function. This event can then be passed to any future function
which must wait for this copy, explicitly indicating the
dependency to the OpenCL run-time. Once this write has finished,
the <code>evCopiedState</code> even will be signalled, releasing any
waiting tasks.</p>
<h4><a id="user-content-executing-the-kernel" class="anchor" aria-hidden="true" href="#executing-the-kernel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Executing the kernel</h4>
<p>Finally! A lot of GPU programming involves setting up a whole
load of infrastructure before actually executing a kernel.
Most of it is boiler-plate, and can be hidden by libraries,
but it is all leading up to this:</p>
<pre><code>cl::NDRange offset(0, 0);				// Always start iterations at x=0, y=0
cl::NDRange globalSize(w, h);	// Global size must match the original loops
cl::NDRange localSize=cl::NullRange;	// We don't care about local size

std::vector&lt;cl::Event&gt; kernelDependencies(1, evCopiedState);
cl::Event evExecutedKernel;
queue.enqueueNDRangeKernel(kernel, offset, globalSize, localSize, &amp;kernelDependencies, &amp;evExecutedKernel);
</code></pre>
<p>The first part is setting up the iteration space, with the <code>offset</code>
specifying that both <code>x</code> and <code>y</code> start and zero, and <code>globalSize</code> saying
that we should loop up to <code>x</code>&lt;<code>w</code> and <code>y</code>&lt;<code>h</code>. The localSize parameter
determines clustering of threads into local work-groups, which
we don't yet care about here (as we're only using global work-groups).</p>
<p>The second part establishes the dependencies of the kernel,
by creating a vector of all the things that
must complete before the kernel can run. For this case, there
is only one dependency: the copy must have completed, so the
event <code>evCopiedState</code> must have completed. We also produce
an event called <code>evExecutedKernel</code>, so that we can tell when
this kernel finishes.</p>
<p>After enqueueing the kernel, we don't know whether the copy
has finished, or the kernel has finished. Maybe both have,
maybe neither has. We cannot assume anything until we
synchronise.</p>
<h4><a id="user-content-copying-the-results-back" class="anchor" aria-hidden="true" href="#copying-the-results-back"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Copying the results back</h4>
<p>The final job is to copy the results back after the kernel
finishes:</p>
<pre><code>std::vector&lt;cl::Event&gt; copyBackDependencies(1, evExecutedKernel);
queue.enqueueReadBuffer(buffBuffer, CL_TRUE, 0, cbBuffer, &amp;buffer[0], &amp;copyBackDependencies);
</code></pre>
<p>The copy cannot start until the kernel has finished, so we have
to indicate the depdendency on <code>evExecutedKernel</code>. However, after
this completes we need to interact with <code>buffer</code>, so we make this
call synchronous using <code>CL_TRUE</code>.</p>
<p>And that's it. You should now have (laboriously) accelerated and
existing C++ program. If all has gone well, the program should
correctly spawn the calculation on the CPU, and perform all
steps correctly. But as always: check to be sure.</p>
<h3><a id="user-content-is-it-fast" class="anchor" aria-hidden="true" href="#is-it-fast"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Is it fast?</h3>
<p>The whole point of this exercise was to make things
faster, and if you time things as they stand, you
may not be that impresssed:</p>
<pre><code>time (bin/make_world | bin/step_world 0.1 1 &gt; /dev/null)
time (bin/make_world | bin/$USER/step_world_v3_opencl 0.1 1 &gt; /dev/null)
</code></pre>
<p>You <em>may</em> find that the opencl version is slower, possibly
by a large amount. This can be attributed to the balance between
two factors:</p>
<ol>
<li>There is a lot of overhead querying device drivers and setting
up OS level information.</li>
<li>The kernel must be compiled from scratch before it can
execute anything.</li>
<li>The amount of compute for the first world is very small, as
the world is tiny and only iterated one step.</li>
</ol>
<p>However, what we want to deal with in practise are:</p>
<ol>
<li>
<p>Large worlds. The greater the resolution of the world, the
more precise the model, and the less the effect of
spatial discretisaion.</p>
</li>
<li>
<p>Small timesteps. Smaller values of <code>dt</code> will give less
discretisation error, resulting in a more accurate model.</p>
</li>
<li>
<p>Large periods. We want to see the steady state of system,
which means running it until it stops changing, which
could be many tens of thousands of iterations.</p>
</li>
</ol>
<p>There is also a large hidden cost at the moment due to
the formatting of the world data, as it is being laboriously
converted to and from text when it is generated in <code>make_world</code>,
and then when it is input and output in <code>step_world</code>. The
reason for the text format is to make it easy to debug, but
there is also a binary format, supported by both programs.
To compare the two, try generating a larger world in text
then binary:</p>
<pre><code>time (bin/make_world 1000 0.1   0  &gt; /dev/null)   # text format
time (bin/make_world 1000 0.1   1  &gt; /dev/null)   # binary format
</code></pre>
<p>Depending on your platform, you'll see between one and
two orders of magnitude in difference between the two. I
would recommend using the binary format when not
debugging, as otherwise your improvements in speed will
be swamped by conversions.</p>
<p>Let's try to eliminate the overheads, by reading from a
binary file and trying to increase the world size a bit:</p>
<pre><code>bin/make_world 1000 0.1 1 &gt; /tmp/world.bin  # Save binary world to temp file
</code></pre>
<p>Now look at the raw cost of execution with no steps at all:</p>
<pre><code>time (cat /tmp/world.bin | bin/step_world 0.1 0  1 &gt; /dev/null) 
time (cat /tmp/world.bin | bin/$USER/step_world_v3_opencl 0.1 0  1 &gt; /dev/null)
</code></pre>
<p>The first command measures the cost of getting the data
in and out, which should be down to tens of milliseconds,
while the second command measures the overhead of
getting the GPU up and running. This will vary depending
on the system, but tells us something useful: if the current
execution time of your program is less than the GPU startup
cost, you will not be able to make it faster using a GPU.</p>
<p>We can check this by measuring the cost of one step:</p>
<pre><code>time (cat /tmp/world.bin | bin/step_world 0.1 1  1 &gt; /dev/null) 
time (cat /tmp/world.bin | bin/$USER/step_world_v3_opencl 0.1 1  1 &gt; /dev/null)
</code></pre>
<p>The difference between this pair of times and the previous
pair of times tells us about the marginal cost of each frame,
after performing setup. Depending on your platform, the GPU
time per frame will be similar to or, more likely, quite a bit slower
than the original CPU.</p>
<p>So what is wrong? We have a number of problems here:</p>
<ol>
<li>
<p>Unecessary copying : we are copying the new state
from GPU buffer back to CPU buffer, doing nothing
with it, then copying the same data back again.</p>
</li>
<li>
<p>Too little work per thread : there is a fixed scheduling
cost in order to spin a GPU thread up. If there is
not much work to do, then the scheduling overhead
outweighs the benefits.</p>
</li>
<li>
<p>No memory optimisations : the current approach places
all data in global memory, which is the slowest memory
type in the GPU. We should be taking advantage of
private and shared memory as well.</p>
</li>
</ol>
<h1><a id="user-content-optimising-cpu-to-gpu-transfers-v4" class="anchor" aria-hidden="true" href="#optimising-cpu-to-gpu-transfers-v4"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optimising CPU to GPU transfers (v4)</h1>
<p>The first thing to try is to remove the redundant memory copies: if you look at
<code>StepWorldV3OpenCL</code> the enqueue read at the bottom of the time loop
will usually end up getting copied straight back over to the GPU at the
top of the next iteration. We only look at the data right at the end, so
there is no point bringing it back to the CPU in-between. So the only
time the data needs to be transferred is:</p>
<ol>
<li>
<p>Before the very first execution of the kernel</p>
</li>
<li>
<p>After the very last execution of the kernel.</p>
</li>
</ol>
<p>Create a new file called <code>src/your_login/step_world_v4_double_buffered.cpp</code>,
based on <code>src/your_login/step_world_v3_opencl.cpp</code>, and name the new
function <code>hpce::your_login::StepWorldV4DoubleBuffered</code>.</p>
<p>We can minimise the transfers by moving the write of <code>buffState</code> off the top
of the loop, and the read of <code>buffBuffer</code> off the bottom. Note that
as you move the read over the call to <code>std::swap</code>, the target
of the read should change: instead of reading into <code>&amp;buffer[0]</code>, it
should read directly into <code>&amp;world.state[0]</code>. To keep things
simple, make both the copies synchronous, so pass CL_TRUE instead
of CL_FALSE, and remove any input and output events.</p>
<p>The only thing that will be left in the time loop is the enqueue of the
kernel, and the swap to flip the world state with the buffer. First
let's fix the buffer, by observing that swapping the host buffers
now has no effect, and we need to swap the GPU buffers being passed
to the kernel instead.</p>
<p>Every time we call the kernel we want to flip the order of
the buffers passed to the kernel, so we need to take the
two <code>setArg</code> calls for the buffers:</p>
<pre><code>kernel.setArg(3, buffState);
kernel.setArg(4, buffBuffer);
</code></pre>
<p>and bring them inside the loop, just above the point where
the kernel is executed.</p>
<p>We also need to swap the two device pointers, so replace
the <code>std::swap</code> of the host buffers with a swap of the
device buffers:</p>
<pre><code>std::swap(buffState, buffBuffer);	// Used to be std::swap(world.state, buffer)
</code></pre>
<p>Now we need to fix the kernel, as currently it has dependencies on
events that no longer exist, so remove the input dependency list
and the output event. You'll now have a loop which just enqueues
kernels, without knowing when they have executed. The problem
is that there is no fixed ordering between the kernels: the run-time
could queue up 10 or 20 calls to enqueue kernel, then issue them
all in parallel. So we need one kernel to finish before the next one starts,
in order to make sure the output buffer is completely written
before the next kernel call uses it as an input buffer.</p>
<p>There are multiple solutions to this, but the easiest is to add a call to
<code>enqueueBarrierWithWaitList</code> just after the kernel is enqueue'd:</p>
<pre><code>queue.enqueueNDRangeKernel(kernel, offset, globalSize, localSize);
	
queue.enqueueBarrierWithWaitList();	// &lt;- new barrier here

std::swap(buffState, buffBuffer);
</code></pre>
<p>This creates a synchronisation point within the command queue,
so anything before the barrier must complete before anything
after the barrier can start. However, it doesn't say anything
about the relationship with the C++ program. It is entirely
possible that the host program could queue up hundreds of
kernel calls and barriers before the OpenCL run-time gets round
to executing them. Indeed, it may only be the synchronised
memory copy <em>after</em> the loop that forces the chain of
kernels and barriers to run at all.</p>
<p>So the inner loop should now look something like:</p>
<pre><code>kernel.setArg(3, buffState);
kernel.setArg(4, buffBuffer);
queue.enqueueNDRangeKernel(kernel, offset, globalSize, localSize);
	
queue.enqueueBarrierWithWaitList();

std::swap(buffState, buffBuffer);
</code></pre>
<p>The kernel code itself is identical to that for the previous
implementation, so you don't need to create a new .cl file. Sometimes
you can optimise execution purely by modifying the host code,
and other times tweaks to the kernel code are all that is needed.</p>
<p>A final problem is that our memory buffers were originally
declared with read-only and write-only flags, but now we
are violating that requirements. Go back to your buffer
declarations, and modify them to:</p>
<pre><code>cl::Buffer buffState(context, CL_MEM_READ_WRITE, cbBuffer);
cl::Buffer buffBuffer(context, CL_MEM_READ_WRITE, cbBuffer);
</code></pre>
<p>There is a lot going on here, so to summarise what the program should
now look like, it should be something like:</p>
<pre lang="text"><code>Create buffProperties : read only
Create buffState, buffBuffer : read/write

Create kernel
Set inner, outer, and properties arguments

write properties data to buffProperties

write initial state to buffState

for t = 0 .. n-1 begin
   Set state argument to buffState
   Set output argument to buffBuffer
   
   enqueue kernel
   
   barrier
   
   swap(buffState, buffBuffer);
end

read buffState into output
</code></pre>
<p>You may find it confusing due to the abstraction of
the <code>cl::Buffer</code>, but it helps if you think of them
as a special kind of pointer. For example, imagine
<code>buffState</code> and <code>buffBuffer</code> have notional addresses
0x4000 and 0x8000 on the GPU. Then what happens
for n=2 is:</p>
<pre><code>buffState = (void*)0x4000;
buffBuffer = (void*)0x8000;

memcpy(originalState , buffState, ...);

///////////////////////////////////////////////////

// loop iteration t=0
// buffState==0x4000, buffBuffer==0x8000

// Reading from 0x4000, writing to 0x8000
kernel(..., input = buffState (0x4000), output = buffBuffer (0x8000))

swap(buffState, buffBuffer); // swaps the values of the pointers

//////////////////////////////////////////////////

// loop iteration t=1
// buffState==0x8000, buffBuffer==0x4000

// reading from 0x8000, writing to 0x4000
kernel(..., input = buffState (0x8000), output = buffBuffer (0x4000))

swap(buffState, buffBuffer);

//////////////////////////////////////////////////

// After loop
// buffState==0x4000, buffBuffer==0x8000

memcpy(buffState, outputState, ...);
</code></pre>
<p>I highly recommend you try this with n=1, n=2, and n=3,
as it is easy to think this is working for n=1 when it fails
for larger numbers.</p>
<p>Depending on your platform, you may now start to see a reasonable
speed-up over software (though maybe still not over TBB - depends
a lot on the hardware).</p>
<h1><a id="user-content-optimising-global-to-gpu-memory-accesses-v5" class="anchor" aria-hidden="true" href="#optimising-global-to-gpu-memory-accesses-v5"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optimising global to GPU memory accesses (v5)</h1>
<p>One of the biggest problems in GPU programming is managing the different memory
spaces. Slight differences in memory layout can cause large changes in
execution time, while moving arrays and variables from global to private
memory can have huge performance implications.
In general, the best memory accesses are those which never happen, so
it is worth-while trying to optimise them out. GPU compilers can be
more conservative then CPU compilers, so it is a good idea to help them
out.</p>
<p>Looking at our current kernel, we can see that there are five reads to
the <code>properties</code> array for a normal cell (non insulator). However, four
of those reads are getting very little information back, as we only depend
on a single bit of information from the four neighbours. A good approach
in such scenarios is to try to pack data into spare bit-fields, increasing
the information density and reducing the number of memory reads. In
this case, we already have one 32-bit integer describing the properties,
of which only 2 bits are currently being used. So as well as the 2 bits describing
the properties of the current cell, we could quite reasonably include four
bits describing whether the four neigbouring cells are insulators or not,
saving a memory access.</p>
<p>This requires two modifications: one in the host code to set up the more
complex flags, and another in the kernel code to take advantage of the
bits.</p>
<h3><a id="user-content-kernel-code" class="anchor" aria-hidden="true" href="#kernel-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kernel code</h3>
<p>Create a new kernel called <code>src/your_login/step_world_v5_packed_properties.cl</code>
based on the v4 kernel.</p>
<p>At the top of the code, read the properties for the current cell into
a private uint variable. This value will be read once into fast private
memory, and then from then on it can be accessed very cheaply.
For each of the branches, rewrite it to check bit-flags in the
variable. For example, if your private properties variable is called <code>myProps</code>,
and you decided bit 3 of the properties indicated whether the cell
above is an insulator, the first branch could be re-written to:</p>
<pre><code>// Cell above
if(myProps &amp; 0x4) {
	contrib += outer;
	acc += outer * world_state[index-w];
}
</code></pre>
<p>The other neighbours will need to depend on different bits in the properties.</p>
<h3><a id="user-content-host-code" class="anchor" aria-hidden="true" href="#host-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Host code</h3>
<p>Create a new implementation called <code>src/your_login/step_world_v5_packed_properties.cpp</code>
based on the v4 host code.</p>
<p>In the host code, you need to make sure the the correct flags have
been inserted into the properties buffer. This should only have local
effect, so we cannot modify <code>world.properties</code> directly. Instead
create a temporary array in host memory:</p>
<pre><code>std::vector&lt;uint32_t&gt; packed(w*h, 0);
</code></pre>
<p>and fill it with the appropriate bits. This will involve looping over all
the co-ordinates, using the following process at each (x,y) co-ordinate:</p>
<pre><code>packed(x,y) = world.properties(x,y)
if world.properties(x,y) is normal:
    if world.properties(x,y-1) is insulator:
        packed(x,y) = packed(x,y) + 4
    if world.properties(x,y+1) is insulator:
        packed(x,y) = packed(x,y) + 8
    # Handle left and right cases
</code></pre>
<p>This process takes some time (though it could be parallellised), but we
don't care too much, as it only happens once for multiple time iterations.
Once the array is prepared, it can be transferred to the
GPU instead of the properties array.</p>
<p>This got my laptop up to about 2.5x speedup, so faster than the two
cores in my device can go. On an AWS g2 GPU instance I looked at a 5000x5000
grid, stepped over 1000 time steps, which is more at the resolution
we typically use:</p>
<pre><code>time (bin/make_world 5000 0.1 1 | bin/step_world 0.1 1000 1 &gt; /dev/null)
time (bin/make_world 5000 0.1 1 | bin/dt10/step_world_v3_opencl 0.1 1000 1 &gt; /dev/null)
time (bin/make_world 5000 0.1 1 | bin/dt10/step_world_v4_double_buffered 0.1 1000 1 &gt; /dev/null)
time (bin/make_world 5000 0.1 1 | bin/dt10/step_world_v5_packed_properties 0.1 1000 1 &gt; /dev/null)
</code></pre>
<p>For my code, I found:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>time (secs)</th>
<th>speedup (total)</th>
<th>speedup (incremental)</th>
</tr>
</thead>
<tbody>
<tr>
<td>software</td>
<td>164.6</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>opencl</td>
<td>66.2</td>
<td>2.5</td>
<td>2.5</td>
</tr>
<tr>
<td>doublebuff</td>
<td>9.0</td>
<td>18.3</td>
<td>7.5</td>
</tr>
<tr>
<td>packing</td>
<td>6.5</td>
<td>25.3</td>
<td>1.4</td>
</tr>
</tbody>
</table>
<p>I strongly encourage you to also try the software OpenCL provider.
The AWS GPU instance has both a GPU and software provider installed,
and you can use <code>HPCE_SELECT_PLATFORM</code> to choose which one you
want. The GPU instance only has 16 cores, and the code is not
optimised for CPU-based OpenCL providers, but it should still be
less than half the time of the original software.</p>
<h1><a id="user-content-further-optimisations" class="anchor" aria-hidden="true" href="#further-optimisations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Further optimisations</h1>
<p>In this context of this particular coursework, we won't go
any further, but the next issue to tackle would be the
small amount of work being done by each thread. At each
co-ordinate there are only a handful of operations performed,
so it would be good to agglomerate (batch up) some
of those operations, to reduce scheduling overhead.
This agglomeration could be temporal, by partially
unrolling multiple iterations, or spatial, by grouping
together consecutive iterations into one larger iteration.</p>
<p>We are also not using shared memory at all, which is wasting
a precious resource. For this problem we want
to have all processors working on the same problem, which
means they need to communicate via global memory and perform
global barriers (which don't formally exist).  However,
there are certain locking mechanisms that can be used to
co-ordinate this, and a hierarchical approach could be used:</p>
<ul>
<li>
<p>Registers: each thread manages a cluster of pixels (e.g. 16),
held locally in registers.</p>
</li>
<li>
<p>Shared: after each time-step each thread exchanges its
halo of 16 pixels with its neighbours via shared memory.</p>
</li>
<li>
<p>Global: after each time-step a sub-set of threads exchange
a coarser halo via global memory. Assume each thread manages
16 pixels, and each workgroup has 256 threads, there would
be a total pixel cout of 4096, but the halo drops down to
256.</p>
</li>
</ul>
<p>Such an approach would rely on hardware level knowledge
to avoid deadlock, but is the kind of thing that might
be done in practise.</p>
<p>Another optimisation is to cache the compiled binary
for the kernel code. Depending on the device, the run-time,
and other system characteristics, compiling the binary
may be very fast, or quite slow. For example, on my
desktop it takes well under a second, but on my laptop
it takes around 10 seconds, both using the AMD OpenCL
implementation. For large numbers of time-steps this
cost will shrink, but for short-lived programs it is
a potentially significant cost. The NVidia provider
actually does this by default, so you may see less of
this effect on such platforms.</p>
<h1><a id="user-content-deliverables" class="anchor" aria-hidden="true" href="#deliverables"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deliverables</h1>
<p>At this point I'm going to stop requiring you to create
graphs, and trust you to use the techniques you have
to understand the various scaling properties. Another
thing I highly reccommend doing is to actually create
a <code>tbb::parallel_for</code> version and compare against that.</p>
<p>Make sure all your source files are checked into your
git repository:</p>
<ul>
<li>
<p><code>src/your_login/step_world_v1_lambda.cpp</code></p>
</li>
<li>
<p><code>src/your_login/step_world_v2_function.cpp</code></p>
</li>
<li>
<p><code>src/your_login/step_world_v3_opencl.cpp</code></p>
</li>
<li>
<p><code>src/your_login/step_world_v3_kernel.cl</code></p>
</li>
<li>
<p><code>src/your_login/step_world_v4_double_buffered.cpp</code></p>
</li>
<li>
<p>(You may have a seperate kernel <code>src/your_login/step_world_v4_double_buffered.cl</code>, or
you may be using <code>src/your_login/step_world_v3_kernel.cl</code> for both).</p>
</li>
<li>
<p><code>src/your_login/step_world_v5_packed_properties.cpp</code></p>
</li>
<li>
<p><code>src/your_login/step_world_v5_packed_properties.cl</code></p>
</li>
</ul>
<p>Each implementation should perform the same step as
the original step_world. While there may be minor
numerical differences due to the single-precision arithmetic,
there should be no major differences in the output over
time.</p>
<p>Also include any useful documents or supporting
material, your repository does not have to be
clean. However, your repository should not contain
compiled artefacts such as executables and object
files, or other large binary objects.</p>
<h1><a id="user-content-submission" class="anchor" aria-hidden="true" href="#submission"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submission</h1>
<p>Submission of code is via your git repository. Make sure
you have committed and pushed to github - you are <em>strongly</em>
encouraged to clone it into a different directory and then
test it, just in case you are relying on something that
wasn't commited.</p>
<p>Once your code is committed, note the <a href="https://blog.thoughtram.io/git/2014/11/18/the-anatomy-of-a-git-commit.html" rel="nofollow">commit hash</a>
of your current revision:</p>
<pre><code>git log -1
</code></pre>
<p>This will produce something like:</p>
<pre><code>ubuntu@ubuntu-xenial:/vagrant$ git log -1
commit 94d8419b20c78da86415bea7236d3719915977a3
Author: James Davis &lt;m8pple@github.com&gt;
Date:   Fri Jan 02 14:26:40 2018 +0000

    All tests passing.
</code></pre>
<p>You can also see the commit hash in the github web-site,
and it is a good way of checking you have actually commited.</p>
<p>The commit hash of this revision is <code>94d8419b20c78da86415bea7236d3719915977a3</code>
which is a cryptographic hash over all the files in your
repository, including the history of all the files. Because
the hash is cryptographically secure, it is impossible to
take one commit hash, then come up with a different
set of files which produces the same hash. The hash produced
on your local machine will also match the hash calculated
by github.</p>
<p>So take your hash (and just the hash), and submit it via blackboard.
This is proof of existence - even if github goes down (and it does),
you can later on prove that the existence of your hash in blackboard
means you must have done the work associated with the hash.
The hash in blackboard will also be the exact revision of your
repository that will get checked out of github and tested. So you
can carry on editing and modifying the repository, but only
the commit with the hash submitted to blackboard is the one tested.</p>
<p>To summarise:</p>
<p>1 - Test your code.</p>
<p>2 - Commit your code to your local repo.</p>
<p>3 - Note the commit hash (<code>git log -1</code>).</p>
<p>4 - Submit the hash via blackboard.</p>
<p>5 - Push the code to your github repo.</p>
<p>You can repeat this process as many times as you want,
up until the deadline.</p>
<h1><a id="user-content-compatibility-patches" class="anchor" aria-hidden="true" href="#compatibility-patches"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compatibility patches</h1>
<h3><a id="user-content-missing-allocah" class="anchor" aria-hidden="true" href="#missing-allocah"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Missing alloca.h</h3>
<p>Windows doesn't have a version of &lt;alloca.h&gt;, so if necessary
just comment it out. See <a href="https://github.com/HPCE/hpce-2015-cw4/issues/6">this issue</a>.</p>
<h1><a id="user-content-debugging-tips" class="anchor" aria-hidden="true" href="#debugging-tips"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging tips</h1>
<h3><a id="user-content-debug-output" class="anchor" aria-hidden="true" href="#debug-output"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debug output</h3>
<p>In this particular exercise, you shouldn't encounter
too many problems, but one useful feature of modern
GPUs is that they allow debugging output, even from
within kernels running in the GPU. In OpenCL 1.2
printf support is enabled by default, so you can use
it from within kernels. Note
that the printf output from different GPU threads
may become interleaved - they are executing truly
in parallel, after all.</p>
<p>In NVidia platforms you may be less lucky, as they try to keep
some functionality CUDA-only for business reasons. However,
you can always try using a software OpenCL implementation
for testing purposes.</p>
<h3><a id="user-content-software-implementations" class="anchor" aria-hidden="true" href="#software-implementations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Software implementations</h3>
<p>Another useful trick when debugging is to fall back
on a software OpenCL implementation if possible. This
can sometimes make it more obvious where a particular
memory address is causing problems, as the exception
occurs on the processor, rather than in the GPU.</p>
<h3><a id="user-content-dynamically-changing-kernels" class="anchor" aria-hidden="true" href="#dynamically-changing-kernels"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dynamically changing kernels</h3>
<p>When OpenCL kernels are held as seperate files, it
makes it very easy to play around with them without
recompiling. For example, when trying to debug a particular
crash or bug in a new or optimised kernel, you can
easily comment out particular lines and re-run the
program. Each kernel gets compiled anyway, so there
is very little overhead to experimenting.</p>
<h3><a id="user-content-locked-up-and-crashing-machines" class="anchor" aria-hidden="true" href="#locked-up-and-crashing-machines"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Locked up and crashing machines</h3>
<p>Some systems are more or less stable than others when
it comes to OpenCL. In principle it should be impossible
to cause any problems using OpenCL code, and each process
should still be isolated from each other. However, in
practise the drivers can be a bit buggy, and it is not
unheard of to see a blue-screen or kernel panic, The
AMD drivers and hardware are particularly problematic
in this regard, at least historically.</p>
<p>However, any such problems are usually due to incorrect
kernel code, which is reading or writing where it shouldn't.
A good starting point is to comment out suspicious memory
writes, or to try working within a software OpenCL implementation
as suggested above.</p>
<p>Even in a correct program, you may find that the OpenCL
code can cause the machine to stutter or lag, in a way
that is quite different to standard CPU load. This is
usually caused due to time-slicing of the GPU with the
graphics display. Older cards cannot run multiple kernels
at the same time, so if the system is running your code,
it cannot update the windows and display. It is generally
a good idea to limit the execution time of any one kernel,
so if possible tune things so that any given thread does not
take more a few hundred milli-seconds. If you are on a server
this is less of an issue, but even there you may find that
the OS aborts kernel calls which take multiple seconds.</p>
</article>
  </div>

    </div>

  

  <details class="details-reset details-overlay details-overlay-dark">
    <summary data-hotkey="l" aria-label="Jump to line"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast linejump" aria-label="Jump to line">
      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-jump-to-line-form Box-body d-flex" action="" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input class="form-control flex-auto mr-3 linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>
        <button type="submit" class="btn" data-close-dialog>Go</button>
</form>    </details-dialog>
  </details>



  </div>
  <div class="modal-backdrop js-touch-events"></div>
</div>

    </div>
  </div>
  

  </div>

        
<div class="footer container-lg px-3" role="contentinfo">
  <div class="position-relative d-flex flex-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <ul class="list-style-none d-flex flex-wrap ">
      <li class="mr-3">&copy; 2019 <span title="0.47597s from unicorn-6897dd8cfc-jk6xh">GitHub</span>, Inc.</li>
        <li class="mr-3"><a data-ga-click="Footer, go to terms, text:terms" href="https://github.com/site/terms">Terms</a></li>
        <li class="mr-3"><a data-ga-click="Footer, go to privacy, text:privacy" href="https://github.com/site/privacy">Privacy</a></li>
        <li class="mr-3"><a data-ga-click="Footer, go to security, text:security" href="https://github.com/security">Security</a></li>
        <li class="mr-3"><a href="https://githubstatus.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
        <li><a data-ga-click="Footer, go to help, text:help" href="https://help.github.com">Help</a></li>
    </ul>

    <a aria-label="Homepage" title="GitHub" class="footer-octicon mr-lg-4" href="https://github.com">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
</a>
   <ul class="list-style-none d-flex flex-wrap ">
        <li class="mr-3"><a data-ga-click="Footer, go to contact, text:contact" href="https://github.com/contact">Contact GitHub</a></li>
        <li class="mr-3"><a href="https://github.com/pricing" data-ga-click="Footer, go to Pricing, text:Pricing">Pricing</a></li>
      <li class="mr-3"><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li class="mr-3"><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
        <li class="mr-3"><a href="https://github.blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a data-ga-click="Footer, go to about, text:about" href="https://github.com/about">About</a></li>

    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>
</div>



  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48L7.48 8z"/></svg>
    </button>
    You can’t perform that action at this time.
  </div>


    
    <script crossorigin="anonymous" integrity="sha512-ZwVwxq7XuYTJgo+RvKEmeGyrm1OTN2Du77YWAfdEiJo9lZbmFO252M4KaMRyDZ3O0bw1OYpF/rJCyQ3g/aa0yA==" type="application/javascript" src="https://github.githubassets.com/assets/frameworks-5e5334deb0beba2b22d055907f8e10a4.js"></script>
    
    <script crossorigin="anonymous" async="async" integrity="sha512-g6sop11ZbJFV7uscd00aBt7HDOZqv7Ew8MlO7sL5m/1wyQRimZuO6C83Zgwug4FXEZ4frKtAAshcDL+cVeo9Fw==" type="application/javascript" src="https://github.githubassets.com/assets/github-9c449ab6e9f7611eadabbf8c88a1e15c.js"></script>
    
    
    
  <div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner d-none">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg>
    <span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
  <template id="site-details-dialog">
  <details class="details-reset details-overlay details-overlay-dark lh-default text-gray-dark" open>
    <summary aria-haspopup="dialog" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog>
        <svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48L7.48 8z"/></svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>
</template>

  <div class="Popover js-hovercard-content position-absolute" style="display: none; outline: none;" tabindex="0">
  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box box-shadow-large" style="width:360px;">
  </div>
</div>

<div id="hovercard-aria-description" class="sr-only">
  Press h to open a hovercard with more details.
</div>

  <div aria-live="polite" class="js-global-screen-reader-notice sr-only"></div>

  </body>
</html>

